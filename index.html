<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FoodHub - Order Nearby</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tg-bg': 'var(--tg-color-bg)',
                        'tg-secondary-bg': 'var(--tg-color-secondary-bg)',
                        'tg-text': 'var(--tg-color-text)',
                        'tg-hint': 'var(--tg-color-hint)',
                        'tg-link': 'var(--tg-color-link)',
                        'tg-button': 'var(--tg-color-button)',
                        'tg-button-text': 'var(--tg-color-button-text)',
                        'tg-header-bg': 'var(--tg-color-header-bg)',
                        'tg-section-bg': 'var(--tg-color-section-bg)',
                        'tg-section-separator': 'var(--tg-color-section-separator)',
                        'primary': '#5D5CDE',
                        'success': '#4CAF50',
                        'warning': '#FF9800',
                        'error': '#F44336',
                    },
                    fontFamily: {
                        'system': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.2s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
                        'bounce-soft': 'bounceSoft 0.5s ease-out',
                        'cart-bounce': 'cartBounce 0.6s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        pulseSoft: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.7' }
                        },
                        bounceSoft: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.05)' }
                        },
                        cartBounce: {
                            '0%': { transform: 'scale(1)' },
                            '25%': { transform: 'scale(1.2)' },
                            '50%': { transform: 'scale(0.9)' },
                            '75%': { transform: 'scale(1.1)' },
                            '100%': { transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --tg-color-bg: #ffffff;
            --tg-color-secondary-bg: #f8f9fa;
            --tg-color-text: #000000;
            --tg-color-hint: #6c757d;
            --tg-color-link: #007bff;
            --tg-color-button: #5D5CDE;
            --tg-color-button-text: #ffffff;
            --tg-color-header-bg: #ffffff;
            --tg-color-section-bg: #ffffff;
            --tg-color-section-separator: #e9ecef;
        }

        .dark {
            --tg-color-bg: #181818;
            --tg-color-secondary-bg: #2a2a2a;
            --tg-color-text: #ffffff;
            --tg-color-hint: #8e8e93;
            --tg-color-link: #64a9ff;
            --tg-color-button: #5D5CDE;
            --tg-color-button-text: #ffffff;
            --tg-color-header-bg: #1f1f1f;
            --tg-color-section-bg: #2a2a2a;
            --tg-color-section-separator: #3a3a3a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--tg-color-bg);
            color: var(--tg-color-text);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton 1.5s infinite;
        }

        .dark .skeleton {
            background: linear-gradient(90deg, #333 25%, #444 50%, #333 75%);
            background-size: 200% 100%;
        }

        @keyframes skeleton {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .haptic-feedback {
            transition: transform 0.1s ease;
        }

        .haptic-feedback:active {
            transform: scale(0.98);
        }

        .safe-area-top {
            padding-top: env(safe-area-inset-top);
        }

        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }

        .section-card {
            background: var(--tg-color-section-bg);
            border-radius: 12px;
            border: 1px solid var(--tg-color-section-separator);
        }

        .restaurant-card {
            background: var(--tg-color-section-bg);
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .dark .restaurant-card {
            box-shadow: 0 2px 8px rgba(255,255,255,0.05);
        }

        .restaurant-card:active {
            transform: scale(0.98);
        }

        .floating-cart {
            background: var(--tg-color-button);
            box-shadow: 0 4px 16px rgba(93, 92, 222, 0.3);
            transition: all 0.2s ease;
        }

        .floating-cart:active {
            transform: scale(0.95);
        }

        .tab-indicator {
            background: var(--tg-color-button);
            height: 2px;
            border-radius: 1px;
            transition: all 0.3s ease;
        }

        .rating-star {
            color: #ffc107;
            font-size: 1.2em;
        }

        .distance-badge {
            background: rgba(93, 92, 222, 0.1);
            color: var(--tg-color-button);
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .category-chip {
            background: var(--tg-color-secondary-bg);
            color: var(--tg-color-text);
            border-radius: 16px;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid var(--tg-color-section-separator);
            transition: all 0.2s ease;
        }

        .category-chip.active {
            background: var(--tg-color-button);
            color: var(--tg-color-button-text);
            border-color: var(--tg-color-button);
        }

        .menu-item {
            transition: all 0.2s ease;
        }

        .menu-item:hover {
            background: var(--tg-color-secondary-bg);
        }

        .quantity-btn {
            background: var(--tg-color-button);
            color: var(--tg-color-button-text);
            border-radius: 8px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .quantity-btn:active {
            transform: scale(0.9);
        }

        .cart-badge {
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            position: absolute;
            top: -8px;
            right: -8px;
            animation: cart-bounce 0.6s ease-out;
        }

        .delivery-status {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 12px;
            padding: 8px 16px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .order-timeline {
            position: relative;
        }

        .order-timeline::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--tg-color-section-separator);
        }

        .timeline-item {
            position: relative;
            padding-left: 40px;
            margin-bottom: 20px;
        }

        .timeline-dot {
            position: absolute;
            left: 8px;
            top: 8px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--tg-color-button);
        }

        .timeline-dot.completed {
            background: #4CAF50;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --tg-color-bg: #181818;
                --tg-color-secondary-bg: #2a2a2a;
                --tg-color-text: #ffffff;
                --tg-color-hint: #8e8e93;
                --tg-color-link: #64a9ff;
                --tg-color-button: #5D5CDE;
                --tg-color-button-text: #ffffff;
                --tg-color-header-bg: #1f1f1f;
                --tg-color-section-bg: #2a2a2a;
                --tg-color-section-separator: #3a3a3a;
            }
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-tg-bg text-tg-text">
    <!-- Header -->
    <header class="bg-tg-header-bg border-b border-tg-section-separator fixed top-0 left-0 right-0 z-50 safe-area-top">
        <div class="flex items-center justify-between px-4 py-3">
            <div class="flex items-center space-x-3">
                <button id="backButton" class="w-8 h-8 flex items-center justify-center rounded-full haptic-feedback opacity-0 pointer-events-none transition-opacity duration-200">
                    <svg class="w-5 h-5 text-tg-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <div>
                    <h1 id="headerTitle" class="text-lg font-semibold text-tg-text">FoodHub</h1>
                    <p id="headerSubtitle" class="text-xs text-tg-hint hidden"></p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <button id="searchButton" class="w-8 h-8 flex items-center justify-center rounded-full haptic-feedback">
                    <svg class="w-5 h-5 text-tg-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </button>
                <button id="notificationButton" class="w-8 h-8 flex items-center justify-center rounded-full haptic-feedback relative">
                    <svg class="w-5 h-5 text-tg-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM11 18h1.09c.07-.3.2-.58.4-.82L16 13.5V10a6 6 0 10-12 0v3.5l3.51 3.68c.2.24.33.52.4.82H9c.5 0 1 .5 1 1z"/>
                    </svg>
                    <div id="notificationBadge" class="cart-badge hidden">1</div>
                </button>
                <button id="profileButton" class="w-8 h-8 rounded-full bg-primary flex items-center justify-center haptic-feedback">
                    <span id="profileInitial" class="text-white text-sm font-medium">?</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-16 pb-20 safe-area-bottom">
        <!-- Home Tab -->
        <div id="homeTab" class="tab-content">
            <!-- Location Banner -->
            <div id="locationBanner" class="mx-4 mt-4 p-4 section-card">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-tg-text">Deliver to</p>
                            <p id="locationText" class="text-xs text-tg-hint">Detecting location...</p>
                        </div>
                    </div>
                    <button id="refreshLocationButton" class="haptic-feedback p-2 rounded-full">
                        <svg class="w-4 h-4 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="mx-4 mt-4">
                <div class="grid grid-cols-4 gap-3">
                    <button class="quick-action-btn section-card p-3 text-center haptic-feedback" data-category="fast-food">
                        <div class="w-8 h-8 mx-auto mb-1 text-2xl">🍔</div>
                        <span class="text-xs text-tg-text">Fast Food</span>
                    </button>
                    <button class="quick-action-btn section-card p-3 text-center haptic-feedback" data-category="pizza">
                        <div class="w-8 h-8 mx-auto mb-1 text-2xl">🍕</div>
                        <span class="text-xs text-tg-text">Pizza</span>
                    </button>
                    <button class="quick-action-btn section-card p-3 text-center haptic-feedback" data-category="asian">
                        <div class="w-8 h-8 mx-auto mb-1 text-2xl">🍜</div>
                        <span class="text-xs text-tg-text">Asian</span>
                    </button>
                    <button class="quick-action-btn section-card p-3 text-center haptic-feedback" data-category="dessert">
                        <div class="w-8 h-8 mx-auto mb-1 text-2xl">🍰</div>
                        <span class="text-xs text-tg-text">Dessert</span>
                    </button>
                </div>
            </div>

            <!-- Category Filter -->
            <div class="mt-6 px-4">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-lg font-semibold text-tg-text">Nearby Restaurants</h2>
                    <button id="filterButton" class="text-sm text-primary haptic-feedback">Filter</button>
                </div>
                <div id="categoryFilter" class="flex space-x-2 overflow-x-auto pb-2">
                    <button class="category-chip active haptic-feedback" data-category="all">All</button>
                    <button class="category-chip haptic-feedback" data-category="fast-food">Fast Food</button>
                    <button class="category-chip haptic-feedback" data-category="pizza">Pizza</button>
                    <button class="category-chip haptic-feedback" data-category="asian">Asian</button>
                    <button class="category-chip haptic-feedback" data-category="italian">Italian</button>
                    <button class="category-chip haptic-feedback" data-category="dessert">Dessert</button>
                </div>
            </div>

            <!-- Restaurant Feed -->
            <div id="restaurantFeed" class="mt-4 px-4 space-y-4">
                <!-- Restaurants will be dynamically loaded here -->
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="mt-4 px-4 space-y-4">
                <div class="restaurant-card p-4">
                    <div class="flex space-x-3">
                        <div class="w-20 h-20 bg-gray-300 rounded-xl skeleton"></div>
                        <div class="flex-1 space-y-2">
                            <div class="h-4 bg-gray-300 rounded skeleton"></div>
                            <div class="h-3 bg-gray-300 rounded w-3/4 skeleton"></div>
                            <div class="h-3 bg-gray-300 rounded w-1/2 skeleton"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="ordersTab" class="tab-content hidden">
            <div class="px-4 py-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-tg-text">My Orders</h2>
                    <button id="trackOrderButton" class="bg-primary text-white px-4 py-2 rounded-lg text-sm haptic-feedback">Track Live</button>
                </div>

                <!-- Active Order -->
                <div id="activeOrderCard" class="section-card p-4 mb-6 hidden">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-tg-text">Active Order</h3>
                        <span class="delivery-status">Preparing</span>
                    </div>
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="w-12 h-12 bg-gray-200 rounded-lg overflow-hidden">
                            <img id="activeOrderImage" src="" alt="" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <p id="activeOrderRestaurant" class="font-medium text-tg-text"></p>
                            <p id="activeOrderItems" class="text-sm text-tg-hint"></p>
                        </div>
                        <div class="text-right">
                            <p id="activeOrderTotal" class="font-semibold text-tg-text"></p>
                            <p id="activeOrderEta" class="text-xs text-tg-hint"></p>
                        </div>
                    </div>
                    <button class="w-full bg-tg-secondary-bg text-tg-text py-2 rounded-lg haptic-feedback">View Details</button>
                </div>

                <!-- Order History -->
                <div id="orderHistory" class="space-y-4">
                    <!-- Order history will be loaded here -->
                </div>

                <!-- Empty State -->
                <div id="emptyOrdersState" class="text-center py-12">
                    <div class="w-20 h-20 bg-tg-secondary-bg rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-10 h-10 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-medium text-tg-text mb-2">No Orders Yet</h3>
                    <p class="text-tg-hint mb-6">Start by ordering your first meal!</p>
                    <button id="browseRestaurantsButton" class="bg-primary text-white px-6 py-3 rounded-xl haptic-feedback">
                        Browse Restaurants
                    </button>
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profileTab" class="tab-content hidden">
            <div class="px-4 py-6">
                <!-- Profile Header -->
                <div class="section-card p-6 text-center mb-6">
                    <div id="profileAvatar" class="w-20 h-20 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <span id="profileAvatarText" class="text-white text-2xl font-medium">?</span>
                    </div>
                    <h2 id="profileName" class="text-xl font-bold text-tg-text mb-1">Loading...</h2>
                    <p id="profileUsername" class="text-tg-hint">@username</p>
                    <div class="flex items-center justify-center space-x-4 mt-4">
                        <div class="text-center">
                            <div id="profileOrderCount" class="text-lg font-bold text-primary">0</div>
                            <div class="text-xs text-tg-hint">Orders</div>
                        </div>
                        <div class="text-center">
                            <div id="profileReviewCount" class="text-lg font-bold text-primary">0</div>
                            <div class="text-xs text-tg-hint">Reviews</div>
                        </div>
                        <div class="text-center">
                            <div id="profilePoints" class="text-lg font-bold text-primary">0</div>
                            <div class="text-xs text-tg-hint">Points</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button id="editProfileButton" class="section-card p-4 flex items-center space-x-3 haptic-feedback">
                        <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        <span class="text-sm text-tg-text">Edit Profile</span>
                    </button>
                    <button id="addressesButton" class="section-card p-4 flex items-center space-x-3 haptic-feedback">
                        <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        </svg>
                        <span class="text-sm text-tg-text">Addresses</span>
                    </button>
                </div>

                <!-- Menu Options -->
                <div class="space-y-4">
                    <div class="section-card">
                        <button class="w-full px-4 py-3 flex items-center justify-between haptic-feedback" id="paymentsButton">
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                </svg>
                                <span class="text-tg-text">Payment Methods</span>
                            </div>
                            <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>

                    <div class="section-card">
                        <button class="w-full px-4 py-3 flex items-center justify-between haptic-feedback" id="favoritesButton">
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                                <span class="text-tg-text">Favorites</span>
                            </div>
                            <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>

                    <div class="section-card">
                        <button class="w-full px-4 py-3 flex items-center justify-between haptic-feedback" id="helpButton">
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span class="text-tg-text">Help & Support</span>
                            </div>
                            <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>

                    <div class="section-card">
                        <button class="w-full px-4 py-3 flex items-center justify-between haptic-feedback" id="shareAppButton">
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                                </svg>
                                <span class="text-tg-text">Share App</span>
                            </div>
                            <svg class="w-5 h-5 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-tg-header-bg border-t border-tg-section-separator safe-area-bottom">
        <div class="flex">
            <button class="tab-button flex-1 py-2 px-4 flex flex-col items-center space-y-1 haptic-feedback" data-tab="home">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"/>
                </svg>
                <span class="text-xs">Home</span>
                <div class="tab-indicator w-12 opacity-100"></div>
            </button>
            <button class="tab-button flex-1 py-2 px-4 flex flex-col items-center space-y-1 haptic-feedback" data-tab="orders">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                </svg>
                <span class="text-xs">Orders</span>
                <div class="tab-indicator w-12 opacity-0"></div>
            </button>
            <button class="tab-button flex-1 py-2 px-4 flex flex-col items-center space-y-1 haptic-feedback" data-tab="profile">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="text-xs">Profile</span>
                <div class="tab-indicator w-12 opacity-0"></div>
            </button>
        </div>
    </nav>

    <!-- Floating Cart Button -->
    <button id="cartButton" class="floating-cart fixed bottom-24 right-4 w-14 h-14 rounded-full flex items-center justify-center haptic-feedback z-40 hidden">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <div id="cartBadge" class="cart-badge">0</div>
    </button>

    <!-- Modals -->
    <!-- Restaurant Menu Modal -->
    <div id="restaurantModal" class="fixed inset-0 modal-overlay flex items-end justify-center z-50 hidden">
        <div class="bg-tg-bg rounded-t-3xl w-full h-5/6 animate-slide-up safe-area-bottom overflow-hidden">
            <div class="flex flex-col h-full">
                <!-- Restaurant Header -->
                <div class="relative">
                    <div class="h-32 bg-gray-200 overflow-hidden">
                        <img id="restaurantImage" src="" alt="" class="w-full h-full object-cover">
                    </div>
                    <button id="closeRestaurantModal" class="absolute top-4 right-4 w-8 h-8 bg-black bg-opacity-50 rounded-full flex items-center justify-center haptic-feedback">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-4">
                        <h3 id="restaurantName" class="text-xl font-bold text-white mb-1"></h3>
                        <div class="flex items-center space-x-2">
                            <span id="restaurantRating" class="text-yellow-400">★ 0.0</span>
                            <span class="text-white text-sm">•</span>
                            <span id="restaurantDeliveryTime" class="text-white text-sm">0-0 min</span>
                            <span class="text-white text-sm">•</span>
                            <span id="restaurantDistance" class="text-white text-sm">0 km</span>
                        </div>
                    </div>
                </div>

                <!-- Menu Categories -->
                <div class="px-4 py-3 border-b border-tg-section-separator">
                    <div id="menuCategories" class="flex space-x-2 overflow-x-auto">
                        <!-- Categories will be loaded here -->
                    </div>
                </div>

                <!-- Menu Items -->
                <div class="flex-1 overflow-y-auto">
                    <div id="menuItems" class="p-4 space-y-4">
                        <!-- Menu items will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 modal-overlay flex items-end justify-center z-50 hidden">
        <div class="bg-tg-bg rounded-t-3xl w-full max-h-5/6 animate-slide-up safe-area-bottom">
            <div class="p-6">
                <div class="w-12 h-1 bg-tg-hint rounded-full mx-auto mb-6"></div>
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-tg-text">Your Order</h3>
                    <button id="clearCartButton" class="text-sm text-error haptic-feedback">Clear All</button>
                </div>
                
                <!-- Cart Items -->
                <div id="cartItems" class="space-y-4 mb-6 max-h-60 overflow-y-auto">
                    <!-- Cart items will be loaded here -->
                </div>

                <!-- Order Summary -->
                <div class="border-t border-tg-section-separator pt-4 mb-6">
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-tg-hint">Subtotal</span>
                            <span id="cartSubtotal" class="text-tg-text">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-tg-hint">Delivery Fee</span>
                            <span id="cartDeliveryFee" class="text-tg-text">$2.99</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-tg-hint">Tax</span>
                            <span id="cartTax" class="text-tg-text">$0.00</span>
                        </div>
                        <div class="flex justify-between font-bold text-lg border-t border-tg-section-separator pt-2">
                            <span class="text-tg-text">Total</span>
                            <span id="cartTotal" class="text-tg-text">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="closeCartModal" class="flex-1 py-3 px-4 bg-tg-secondary-bg text-tg-text rounded-xl haptic-feedback">Continue Shopping</button>
                    <button id="checkoutButton" class="flex-1 py-3 px-4 bg-primary text-white rounded-xl haptic-feedback">Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div id="searchModal" class="fixed inset-0 bg-tg-bg z-50 hidden">
        <div class="p-4 safe-area-top">
            <div class="flex items-center space-x-3 mb-4">
                <button id="closeSearchModal" class="haptic-feedback">
                    <svg class="w-6 h-6 text-tg-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <div class="flex-1 relative">
                    <input type="text" id="searchInput" 
                           class="w-full px-4 py-3 pl-10 bg-tg-secondary-bg text-tg-text rounded-xl border border-tg-section-separator focus:outline-none focus:ring-2 focus:ring-primary/30 text-base"
                           placeholder="Search restaurants or dishes...">
                    <svg class="w-5 h-5 text-tg-hint absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
            </div>
            
            <!-- Search Results -->
            <div id="searchResults" class="space-y-4">
                <!-- Search results will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Telegram Web App Integration
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // App State Management
        class FoodHubApp {
            constructor() {
                this.currentUser = null;
                this.userLocation = null;
                this.restaurants = [];
                this.cart = [];
                this.orders = [];
                this.currentTab = 'home';
                this.selectedCategory = 'all';
                this.selectedRestaurant = null;
                this.navigationStack = [];
                this.init();
            }

            init() {
                this.setupTelegramIntegration();
                this.loadSampleData();
                this.setupEventListeners();
                this.setupTheme();
                this.requestLocation();
                this.loadUserData();
                this.loadCartFromStorage();
            }

            setupTelegramIntegration() {
                // Theme detection
                if (tg.colorScheme === 'dark') {
                    document.documentElement.classList.add('dark');
                }

                // BackButton handling
                tg.BackButton.onClick(() => {
                    if (this.navigationStack.length > 0) {
                        const prevState = this.navigationStack.pop();
                        this.navigateBack(prevState);
                    } else {
                        tg.close();
                    }
                });

                // MainButton configuration
                tg.MainButton.text = "Place Order";
                tg.MainButton.color = "#5D5CDE";

                // Haptic feedback setup
                this.hapticFeedback = tg.HapticFeedback;

                // User data from Telegram
                if (tg.initDataUnsafe?.user) {
                    this.currentUser = {
                        id: tg.initDataUnsafe.user.id,
                        firstName: tg.initDataUnsafe.user.first_name,
                        lastName: tg.initDataUnsafe.user.last_name || '',
                        username: tg.initDataUnsafe.user.username || '',
                        languageCode: tg.initDataUnsafe.user.language_code || 'en',
                        photoUrl: tg.initDataUnsafe.user.photo_url || null
                    };
                }
            }

            setupTheme() {
                // Auto theme detection
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                }
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    if (event.matches) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                });
            }

            loadSampleData() {
                // Sample restaurants data
                this.restaurants = [
                    {
                        id: 1,
                        name: "Mario's Pizzeria",
                        category: "pizza",
                        description: "Authentic Italian pizza made with fresh ingredients",
                        rating: 4.8,
                        reviewCount: 342,
                        location: { lat: 37.7749, lng: -122.4194, address: "123 Main St" },
                        distance: 0.8,
                        deliveryTime: "20-30",
                        deliveryFee: 2.99,
                        minimumOrder: 15.00,
                        image: "https://picsum.photos/400/300?random=1",
                        isOpen: true,
                        categories: ["Pizza", "Italian", "Desserts"],
                        menu: [
                            {
                                id: 101,
                                name: "Margherita Pizza",
                                description: "Fresh mozzarella, tomato sauce, basil",
                                price: 16.99,
                                category: "Pizza",
                                image: "https://picsum.photos/300/200?random=11",
                                rating: 4.9,
                                popular: true
                            },
                            {
                                id: 102,
                                name: "Pepperoni Pizza",
                                description: "Classic pepperoni with mozzarella cheese",
                                price: 18.99,
                                category: "Pizza",
                                image: "https://picsum.photos/300/200?random=12",
                                rating: 4.7
                            },
                            {
                                id: 103,
                                name: "Caesar Salad",
                                description: "Romaine lettuce, parmesan, croutons, caesar dressing",
                                price: 12.99,
                                category: "Salads",
                                image: "https://picsum.photos/300/200?random=13",
                                rating: 4.5
                            },
                            {
                                id: 104,
                                name: "Tiramisu",
                                description: "Classic Italian dessert with coffee and mascarpone",
                                price: 8.99,
                                category: "Desserts",
                                image: "https://picsum.photos/300/200?random=14",
                                rating: 4.8
                            }
                        ]
                    },
                    {
                        id: 2,
                        name: "Burger Palace",
                        category: "fast-food",
                        description: "Gourmet burgers made with premium beef",
                        rating: 4.6,
                        reviewCount: 218,
                        location: { lat: 37.7849, lng: -122.4094, address: "456 Oak Ave" },
                        distance: 1.2,
                        deliveryTime: "15-25",
                        deliveryFee: 1.99,
                        minimumOrder: 12.00,
                        image: "https://picsum.photos/400/300?random=2",
                        isOpen: true,
                        categories: ["Burgers", "Fries", "Drinks"],
                        menu: [
                            {
                                id: 201,
                                name: "Classic Cheeseburger",
                                description: "Beef patty, cheese, lettuce, tomato, onion",
                                price: 12.99,
                                category: "Burgers",
                                image: "https://picsum.photos/300/200?random=21",
                                rating: 4.7,
                                popular: true
                            },
                            {
                                id: 202,
                                name: "Bacon Deluxe",
                                description: "Double beef, bacon, cheese, special sauce",
                                price: 15.99,
                                category: "Burgers",
                                image: "https://picsum.photos/300/200?random=22",
                                rating: 4.8
                            },
                            {
                                id: 203,
                                name: "Crispy Fries",
                                description: "Golden crispy potato fries with sea salt",
                                price: 4.99,
                                category: "Fries",
                                image: "https://picsum.photos/300/200?random=23",
                                rating: 4.4
                            }
                        ]
                    },
                    {
                        id: 3,
                        name: "Dragon Noodles",
                        category: "asian",
                        description: "Authentic Asian cuisine with fresh ingredients",
                        rating: 4.7,
                        reviewCount: 156,
                        location: { lat: 37.7649, lng: -122.4294, address: "789 Pine St" },
                        distance: 2.1,
                        deliveryTime: "25-35",
                        deliveryFee: 3.99,
                        minimumOrder: 20.00,
                        image: "https://picsum.photos/400/300?random=3",
                        isOpen: true,
                        categories: ["Noodles", "Rice", "Appetizers"],
                        menu: [
                            {
                                id: 301,
                                name: "Pad Thai",
                                description: "Stir-fried rice noodles with shrimp, tofu, and peanuts",
                                price: 14.99,
                                category: "Noodles",
                                image: "https://picsum.photos/300/200?random=31",
                                rating: 4.9,
                                popular: true
                            },
                            {
                                id: 302,
                                name: "Chicken Fried Rice",
                                description: "Wok-fried rice with chicken, vegetables, and soy sauce",
                                price: 13.99,
                                category: "Rice",
                                image: "https://picsum.photos/300/200?random=32",
                                rating: 4.6
                            }
                        ]
                    },
                    {
                        id: 4,
                        name: "Sweet Treats",
                        category: "dessert",
                        description: "Delicious desserts and sweet treats",
                        rating: 4.9,
                        reviewCount: 89,
                        location: { lat: 37.7549, lng: -122.4394, address: "321 Sugar Lane" },
                        distance: 1.5,
                        deliveryTime: "10-20",
                        deliveryFee: 2.49,
                        minimumOrder: 8.00,
                        image: "https://picsum.photos/400/300?random=4",
                        isOpen: true,
                        categories: ["Cakes", "Ice Cream", "Cookies"],
                        menu: [
                            {
                                id: 401,
                                name: "Chocolate Cake",
                                description: "Rich chocolate layer cake with chocolate frosting",
                                price: 6.99,
                                category: "Cakes",
                                image: "https://picsum.photos/300/200?random=41",
                                rating: 4.8,
                                popular: true
                            },
                            {
                                id: 402,
                                name: "Vanilla Ice Cream",
                                description: "Premium vanilla ice cream made with real vanilla beans",
                                price: 4.99,
                                category: "Ice Cream",
                                image: "https://picsum.photos/300/200?random=42",
                                rating: 4.7
                            }
                        ]
                    }
                ];

                // Sample order history
                this.orders = [
                    {
                        id: 'ORD001',
                        restaurantId: 1,
                        restaurantName: "Mario's Pizzeria",
                        items: [
                            { id: 101, name: "Margherita Pizza", price: 16.99, quantity: 1 },
                            { id: 104, name: "Tiramisu", price: 8.99, quantity: 1 }
                        ],
                        subtotal: 25.98,
                        deliveryFee: 2.99,
                        tax: 2.34,
                        total: 31.31,
                        status: 'delivered',
                        orderTime: new Date('2024-01-10T18:30:00'),
                        deliveryTime: new Date('2024-01-10T19:15:00'),
                        rating: 5
                    }
                ];
            }

            setupEventListeners() {
                // Tab navigation
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        this.triggerHaptic('impact', 'light');
                        const tab = e.currentTarget.dataset.tab;
                        this.switchTab(tab);
                    });
                });

                // Quick action buttons
                document.querySelectorAll('.quick-action-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        this.triggerHaptic('impact', 'light');
                        const category = e.currentTarget.dataset.category;
                        this.filterByCategory(category);
                    });
                });

                // Category filtering
                document.getElementById('categoryFilter').addEventListener('click', (e) => {
                    if (e.target.classList.contains('category-chip')) {
                        this.triggerHaptic('impact', 'light');
                        document.querySelectorAll('.category-chip').forEach(chip => chip.classList.remove('active'));
                        e.target.classList.add('active');
                        this.selectedCategory = e.target.dataset.category;
                        this.filterAndRenderRestaurants();
                    }
                });

                // Location refresh
                document.getElementById('refreshLocationButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.requestLocation();
                });

                // Header buttons
                document.getElementById('profileButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.switchTab('profile');
                });

                document.getElementById('searchButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showSearchModal();
                });

                document.getElementById('notificationButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showNotifications();
                });

                // Cart button
                document.getElementById('cartButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'medium');
                    this.showCartModal();
                });

                // Modal handlers
                this.setupModalHandlers();
                this.setupProfileActions();

                // Back button
                document.getElementById('backButton').addEventListener('click', () => {
                    if (this.navigationStack.length > 0) {
                        const prevState = this.navigationStack.pop();
                        this.navigateBack(prevState);
                    }
                });
            }

            setupModalHandlers() {
                // Restaurant modal
                document.getElementById('closeRestaurantModal').addEventListener('click', () => {
                    this.hideRestaurantModal();
                });

                // Cart modal
                document.getElementById('closeCartModal').addEventListener('click', () => {
                    this.hideCartModal();
                });

                document.getElementById('clearCartButton').addEventListener('click', () => {
                    this.clearCart();
                });

                document.getElementById('checkoutButton').addEventListener('click', () => {
                    this.checkout();
                });

                // Search modal
                document.getElementById('closeSearchModal').addEventListener('click', () => {
                    this.hideSearchModal();
                });

                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.performSearch(e.target.value);
                });

                // Click outside to close modals
                document.getElementById('restaurantModal').addEventListener('click', (e) => {
                    if (e.target.id === 'restaurantModal') {
                        this.hideRestaurantModal();
                    }
                });

                document.getElementById('cartModal').addEventListener('click', (e) => {
                    if (e.target.id === 'cartModal') {
                        this.hideCartModal();
                    }
                });
            }

            setupProfileActions() {
                document.getElementById('editProfileButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showEditProfile();
                });

                document.getElementById('addressesButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showAddresses();
                });

                document.getElementById('paymentsButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showPaymentMethods();
                });

                document.getElementById('favoritesButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showFavorites();
                });

                document.getElementById('helpButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showHelp();
                });

                document.getElementById('shareAppButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.shareApp();
                });

                document.getElementById('browseRestaurantsButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.switchTab('home');
                });

                document.getElementById('trackOrderButton').addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showOrderTracking();
                });
            }

            requestLocation() {
                const locationText = document.getElementById('locationText');
                locationText.textContent = 'Detecting location...';

                if ('geolocation' in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            this.userLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                accuracy: position.coords.accuracy
                            };
                            this.updateLocationDisplay();
                            this.calculateDistances();
                            this.filterAndRenderRestaurants();
                        },
                        (error) => {
                            console.error('Geolocation error:', error);
                            locationText.textContent = 'Location unavailable';
                            // Use default location
                            this.userLocation = { lat: 37.7749, lng: -122.4194 };
                            this.calculateDistances();
                            this.filterAndRenderRestaurants();
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 300000
                        }
                    );
                } else {
                    locationText.textContent = 'Location not supported';
                }
            }

            updateLocationDisplay() {
                const locationText = document.getElementById('locationText');
                if (this.userLocation) {
                    locationText.textContent = 'Current Location';
                }
            }

            calculateDistances() {
                if (!this.userLocation) return;

                this.restaurants.forEach(restaurant => {
                    restaurant.distance = this.calculateDistance(
                        this.userLocation.lat,
                        this.userLocation.lng,
                        restaurant.location.lat,
                        restaurant.location.lng
                    );
                });

                this.restaurants.sort((a, b) => a.distance - b.distance);
            }

            calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371;
                const dLat = this.degToRad(lat2 - lat1);
                const dLon = this.degToRad(lon2 - lon1);
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(this.degToRad(lat1)) * Math.cos(this.degToRad(lat2)) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            }

            degToRad(deg) {
                return deg * (Math.PI/180);
            }

            loadUserData() {
                if (this.currentUser) {
                    const profileName = document.getElementById('profileName');
                    const profileUsername = document.getElementById('profileUsername');
                    const profileInitial = document.getElementById('profileInitial');
                    const profileAvatarText = document.getElementById('profileAvatarText');

                    const fullName = `${this.currentUser.firstName} ${this.currentUser.lastName}`.trim();
                    profileName.textContent = fullName || 'User';
                    profileUsername.textContent = this.currentUser.username ? `@${this.currentUser.username}` : '';
                    
                    const initial = this.currentUser.firstName ? this.currentUser.firstName[0].toUpperCase() : '?';
                    profileInitial.textContent = initial;
                    profileAvatarText.textContent = initial;

                    this.updateUserStats();
                }
            }

            updateUserStats() {
                const orderCount = this.orders.length;
                const reviewCount = this.orders.filter(order => order.rating).length;
                const points = orderCount * 10;

                document.getElementById('profileOrderCount').textContent = orderCount;
                document.getElementById('profileReviewCount').textContent = reviewCount;
                document.getElementById('profilePoints').textContent = points;
            }

            loadCartFromStorage() {
                // In a real app, this would load from Telegram Cloud Storage
                const savedCart = localStorage.getItem('foodhub_cart');
                if (savedCart) {
                    this.cart = JSON.parse(savedCart);
                    this.updateCartUI();
                }
            }

            saveCartToStorage() {
                localStorage.setItem('foodhub_cart', JSON.stringify(this.cart));
            }

            switchTab(tabName) {
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });

                document.getElementById(`${tabName}Tab`).classList.remove('hidden');

                document.querySelectorAll('.tab-button').forEach(button => {
                    const indicator = button.querySelector('.tab-indicator');
                    if (button.dataset.tab === tabName) {
                        button.classList.add('text-primary');
                        indicator.classList.remove('opacity-0');
                        indicator.classList.add('opacity-100');
                    } else {
                        button.classList.remove('text-primary');
                        indicator.classList.add('opacity-0');
                        indicator.classList.remove('opacity-100');
                    }
                });

                this.currentTab = tabName;
                this.updateHeader(tabName);

                if (tabName === 'home') {
                    this.filterAndRenderRestaurants();
                } else if (tabName === 'orders') {
                    this.renderOrders();
                }
            }

            updateHeader(tabName) {
                const headerTitle = document.getElementById('headerTitle');
                const headerSubtitle = document.getElementById('headerSubtitle');
                const backButton = document.getElementById('backButton');

                switch (tabName) {
                    case 'home':
                        headerTitle.textContent = 'FoodHub';
                        headerSubtitle.classList.add('hidden');
                        this.hideBackButton();
                        break;
                    case 'orders':
                        headerTitle.textContent = 'My Orders';
                        headerSubtitle.classList.add('hidden');
                        this.hideBackButton();
                        break;
                    case 'profile':
                        headerTitle.textContent = 'Profile';
                        headerSubtitle.classList.add('hidden');
                        this.hideBackButton();
                        break;
                }
            }

            showBackButton() {
                const backButton = document.getElementById('backButton');
                backButton.classList.remove('opacity-0', 'pointer-events-none');
                backButton.classList.add('opacity-100');
                tg.BackButton.show();
            }

            hideBackButton() {
                const backButton = document.getElementById('backButton');
                backButton.classList.add('opacity-0', 'pointer-events-none');
                backButton.classList.remove('opacity-100');
                tg.BackButton.hide();
            }

            filterByCategory(category) {
                this.selectedCategory = category;
                document.querySelectorAll('.category-chip').forEach(chip => chip.classList.remove('active'));
                document.querySelector(`[data-category="${category}"]`).classList.add('active');
                this.filterAndRenderRestaurants();
            }

            filterAndRenderRestaurants() {
                let filteredRestaurants = [...this.restaurants];

                if (this.selectedCategory !== 'all') {
                    filteredRestaurants = filteredRestaurants.filter(restaurant => 
                        restaurant.category === this.selectedCategory
                    );
                }

                this.renderRestaurants(filteredRestaurants);
            }

            renderRestaurants(restaurants) {
                const feed = document.getElementById('restaurantFeed');
                const loadingState = document.getElementById('loadingState');

                loadingState.classList.add('hidden');
                feed.innerHTML = '';

                if (restaurants.length === 0) {
                    feed.innerHTML = `
                        <div class="text-center py-12">
                            <div class="w-20 h-20 bg-tg-secondary-bg rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-10 h-10 text-tg-hint" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-medium text-tg-text mb-2">No Restaurants Found</h3>
                            <p class="text-tg-hint">Try a different category or location</p>
                        </div>
                    `;
                    return;
                }

                restaurants.forEach(restaurant => {
                    const restaurantCard = this.createRestaurantCard(restaurant);
                    feed.appendChild(restaurantCard);
                });
            }

            createRestaurantCard(restaurant) {
                const card = document.createElement('div');
                card.className = 'restaurant-card p-4 haptic-feedback cursor-pointer';

                const stars = '★'.repeat(Math.floor(restaurant.rating));
                const deliveryFeeText = restaurant.deliveryFee > 0 ? `$${restaurant.deliveryFee.toFixed(2)}` : 'Free';

                card.innerHTML = `
                    <div class="flex space-x-3 mb-3">
                        <div class="w-20 h-20 bg-gray-200 rounded-xl overflow-hidden flex-shrink-0">
                            <img src="${restaurant.image}" alt="${restaurant.name}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between mb-1">
                                <h3 class="font-semibold text-tg-text truncate">${restaurant.name}</h3>
                                <span class="distance-badge ml-2">${restaurant.distance.toFixed(1)} km</span>
                            </div>
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-yellow-500 text-sm">${stars}</span>
                                <span class="text-xs text-tg-hint">${restaurant.rating} (${restaurant.reviewCount})</span>
                            </div>
                            <p class="text-xs text-tg-hint line-clamp-2 mb-2">${restaurant.description}</p>
                            <div class="flex items-center space-x-3 text-xs text-tg-hint">
                                <span>🕒 ${restaurant.deliveryTime} min</span>
                                <span>🚚 ${deliveryFeeText}</span>
                                <span class="category-chip text-xs px-2 py-1">${restaurant.category}</span>
                            </div>
                        </div>
                    </div>
                `;

                card.addEventListener('click', () => {
                    this.triggerHaptic('impact', 'light');
                    this.showRestaurantMenu(restaurant);
                });

                return card;
            }

            showRestaurantMenu(restaurant) {
                this.selectedRestaurant = restaurant;
                const modal = document.getElementById('restaurantModal');
                
                // Update restaurant info
                document.getElementById('restaurantImage').src = restaurant.image;
                document.getElementById('restaurantName').textContent = restaurant.name;
                document.getElementById('restaurantRating').textContent = `★ ${restaurant.rating}`;
                document.getElementById('restaurantDeliveryTime').textContent = `${restaurant.deliveryTime} min`;
                document.getElementById('restaurantDistance').textContent = `${restaurant.distance.toFixed(1)} km`;

                // Render menu categories
                this.renderMenuCategories(restaurant.categories);
                
                // Render menu items
                this.renderMenuItems(restaurant.menu);

                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                this.navigationStack.push({ tab: this.currentTab });
                this.showBackButton();
            }

            hideRestaurantModal() {
                const modal = document.getElementById('restaurantModal');
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                
                if (this.navigationStack.length > 0) {
                    this.navigationStack.pop();
                }
                this.hideBackButton();
            }

            renderMenuCategories(categories) {
                const container = document.getElementById('menuCategories');
                container.innerHTML = '';

                categories.forEach(category => {
                    const chip = document.createElement('button');
                    chip.className = 'category-chip haptic-feedback';
                    chip.textContent = category;
                    container.appendChild(chip);
                });
            }

            renderMenuItems(menuItems) {
                const container = document.getElementById('menuItems');
                container.innerHTML = '';

                menuItems.forEach(item => {
                    const itemCard = this.createMenuItemCard(item);
                    container.appendChild(itemCard);
                });
            }

            createMenuItemCard(item) {
                const card = document.createElement('div');
                card.className = 'menu-item section-card p-4 rounded-xl';

                const stars = '★'.repeat(Math.floor(item.rating));
                const popularBadge = item.popular ? '<span class="bg-primary text-white text-xs px-2 py-1 rounded-full">Popular</span>' : '';

                card.innerHTML = `
                    <div class="flex space-x-3">
                        <div class="flex-1">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-semibold text-tg-text">${item.name}</h4>
                                ${popularBadge}
                            </div>
                            <p class="text-sm text-tg-hint line-clamp-2 mb-2">${item.description}</p>
                            <div class="flex items-center space-x-2 mb-3">
                                <span class="text-yellow-500 text-sm">${stars}</span>
                                <span class="text-xs text-tg-hint">${item.rating}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-lg font-bold text-tg-text">$${item.price.toFixed(2)}</span>
                                <div class="flex items-center space-x-2">
                                    <button class="quantity-btn haptic-feedback" onclick="app.removeFromCart(${item.id})">-</button>
                                    <span class="item-quantity-${item.id} w-8 text-center">${this.getItemQuantity(item.id)}</span>
                                    <button class="quantity-btn haptic-feedback" onclick="app.addToCart(${item.id})">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="w-20 h-20 bg-gray-200 rounded-xl overflow-hidden flex-shrink-0">
                            <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
                        </div>
                    </div>
                `;

                return card;
            }

            addToCart(itemId) {
                this.triggerHaptic('impact', 'light');
                
                const restaurant = this.selectedRestaurant;
                const item = restaurant.menu.find(i => i.id === itemId);
                
                const existingItem = this.cart.find(cartItem => cartItem.id === itemId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    this.cart.push({
                        ...item,
                        restaurantId: restaurant.id,
                        restaurantName: restaurant.name,
                        quantity: 1
                    });
                }

                this.updateCartUI();
                this.updateMenuItemQuantity(itemId);
                this.saveCartToStorage();
            }

            removeFromCart(itemId) {
                this.triggerHaptic('impact', 'light');
                
                const existingItem = this.cart.find(cartItem => cartItem.id === itemId);
                
                if (existingItem && existingItem.quantity > 1) {
                    existingItem.quantity -= 1;
                } else {
                    this.cart = this.cart.filter(cartItem => cartItem.id !== itemId);
                }

                this.updateCartUI();
                this.updateMenuItemQuantity(itemId);
                this.saveCartToStorage();
            }

            getItemQuantity(itemId) {
                const item = this.cart.find(cartItem => cartItem.id === itemId);
                return item ? item.quantity : 0;
            }

            updateMenuItemQuantity(itemId) {
                const quantityElement = document.querySelector(`.item-quantity-${itemId}`);
                if (quantityElement) {
                    quantityElement.textContent = this.getItemQuantity(itemId);
                }
            }

            updateCartUI() {
                const cartButton = document.getElementById('cartButton');
                const cartBadge = document.getElementById('cartBadge');
                
                const totalItems = this.cart.reduce((sum, item) => sum + item.quantity, 0);
                
                if (totalItems > 0) {
                    cartButton.classList.remove('hidden');
                    cartBadge.textContent = totalItems;
                    cartBadge.classList.remove('hidden');
                } else {
                    cartButton.classList.add('hidden');
                }
            }

            showCartModal() {
                const modal = document.getElementById('cartModal');
                this.renderCartItems();
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            hideCartModal() {
                const modal = document.getElementById('cartModal');
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }

            renderCartItems() {
                const container = document.getElementById('cartItems');
                container.innerHTML = '';

                this.cart.forEach(item => {
                    const itemCard = this.createCartItemCard(item);
                    container.appendChild(itemCard);
                });

                this.updateCartSummary();
            }

            createCartItemCard(item) {
                const card = document.createElement('div');
                card.className = 'flex items-center space-x-3 p-3 bg-tg-secondary-bg rounded-xl';

                card.innerHTML = `
                    <div class="w-12 h-12 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0">
                        <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-1">
                        <h4 class="font-medium text-tg-text">${item.name}</h4>
                        <p class="text-sm text-tg-hint">${item.restaurantName}</p>
                        <p class="text-sm font-semibold text-tg-text">$${item.price.toFixed(2)}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="quantity-btn haptic-feedback" onclick="app.removeFromCart(${item.id})">-</button>
                        <span class="w-8 text-center">${item.quantity}</span>
                        <button class="quantity-btn haptic-feedback" onclick="app.addToCart(${item.id})">+</button>
                    </div>
                `;

                return card;
            }

            updateCartSummary() {
                const subtotal = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const deliveryFee = 2.99;
                const tax = subtotal * 0.08875;
                const total = subtotal + deliveryFee + tax;

                document.getElementById('cartSubtotal').textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById('cartDeliveryFee').textContent = `$${deliveryFee.toFixed(2)}`;
                document.getElementById('cartTax').textContent = `$${tax.toFixed(2)}`;
                document.getElementById('cartTotal').textContent = `$${total.toFixed(2)}`;
            }

            clearCart() {
                this.triggerHaptic('impact', 'medium');
                this.cart = [];
                this.updateCartUI();
                this.renderCartItems();
                this.saveCartToStorage();
                
                // Update menu item quantities if restaurant modal is open
                if (!document.getElementById('restaurantModal').classList.contains('hidden')) {
                    document.querySelectorAll('[class*="item-quantity-"]').forEach(el => {
                        el.textContent = '0';
                    });
                }
            }

            checkout() {
                if (this.cart.length === 0) {
                    this.showToast('Your cart is empty');
                    return;
                }

                this.triggerHaptic('notification', 'success');
                
                // Create order
                const order = {
                    id: `ORD${Date.now()}`,
                    restaurantId: this.cart[0].restaurantId,
                    restaurantName: this.cart[0].restaurantName,
                    items: [...this.cart],
                    subtotal: this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    deliveryFee: 2.99,
                    tax: this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) * 0.08875,
                    total: 0,
                    status: 'confirmed',
                    orderTime: new Date(),
                    estimatedDelivery: new Date(Date.now() + 30 * 60 * 1000) // 30 minutes
                };
                
                order.total = order.subtotal + order.deliveryFee + order.tax;
                
                this.orders.unshift(order);
                this.cart = [];
                this.updateCartUI();
                this.hideCartModal();
                this.hideRestaurantModal();
                this.saveCartToStorage();
                
                this.showToast('Order placed successfully! 🎉');
                this.switchTab('orders');
            }

            renderOrders() {
                const container = document.getElementById('orderHistory');
                const emptyState = document.getElementById('emptyOrdersState');
                const activeOrderCard = document.getElementById('activeOrderCard');

                if (this.orders.length === 0) {
                    container.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    activeOrderCard.classList.add('hidden');
                    return;
                }

                container.classList.remove('hidden');
                emptyState.classList.add('hidden');

                // Show active order if exists
                const activeOrder = this.orders.find(order => ['confirmed', 'preparing', 'on_way'].includes(order.status));
                if (activeOrder) {
                    this.renderActiveOrder(activeOrder);
                    activeOrderCard.classList.remove('hidden');
                } else {
                    activeOrderCard.classList.add('hidden');
                }

                container.innerHTML = '';
                this.orders.forEach(order => {
                    if (!['confirmed', 'preparing', 'on_way'].includes(order.status)) {
                        const orderCard = this.createOrderCard(order);
                        container.appendChild(orderCard);
                    }
                });
            }

            renderActiveOrder(order) {
                document.getElementById('activeOrderImage').src = `https://picsum.photos/100/100?random=${order.restaurantId}`;
                document.getElementById('activeOrderRestaurant').textContent = order.restaurantName;
                document.getElementById('activeOrderItems').textContent = `${order.items.length} items`;
                document.getElementById('activeOrderTotal').textContent = `$${order.total.toFixed(2)}`;
                document.getElementById('activeOrderEta').textContent = '25-30 min';
            }

            createOrderCard(order) {
                const card = document.createElement('div');
                card.className = 'section-card p-4 haptic-feedback cursor-pointer';

                const timeAgo = this.getTimeAgo(order.orderTime);
                const statusColors = {
                    delivered: 'text-success',
                    cancelled: 'text-error',
                    confirmed: 'text-primary',
                    preparing: 'text-warning',
                    on_way: 'text-primary'
                };

                card.innerHTML = `
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="w-12 h-12 bg-gray-200 rounded-lg overflow-hidden">
                            <img src="https://picsum.photos/100/100?random=${order.restaurantId}" alt="${order.restaurantName}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-tg-text">${order.restaurantName}</h4>
                            <p class="text-sm text-tg-hint">${order.items.length} items • $${order.total.toFixed(2)}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-xs ${statusColors[order.status]} font-medium capitalize">${order.status}</span>
                            <p class="text-xs text-tg-hint">${timeAgo}</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-tg-hint">Order #${order.id}</span>
                        <button class="text-sm text-primary">Reorder</button>
                    </div>
                `;

                return card;
            }

            showSearchModal() {
                const modal = document.getElementById('searchModal');
                modal.classList.remove('hidden');
                document.getElementById('searchInput').focus();
            }

            hideSearchModal() {
                const modal = document.getElementById('searchModal');
                modal.classList.add('hidden');
                document.getElementById('searchInput').value = '';
                document.getElementById('searchResults').innerHTML = '';
            }

            performSearch(query) {
                const results = document.getElementById('searchResults');
                
                if (query.length < 2) {
                    results.innerHTML = '';
                    return;
                }

                // Search restaurants and menu items
                const restaurantResults = this.restaurants.filter(restaurant =>
                    restaurant.name.toLowerCase().includes(query.toLowerCase()) ||
                    restaurant.description.toLowerCase().includes(query.toLowerCase())
                );

                const menuResults = [];
                this.restaurants.forEach(restaurant => {
                    restaurant.menu.forEach(item => {
                        if (item.name.toLowerCase().includes(query.toLowerCase()) ||
                            item.description.toLowerCase().includes(query.toLowerCase())) {
                            menuResults.push({ ...item, restaurantName: restaurant.name, restaurant });
                        }
                    });
                });

                this.renderSearchResults(restaurantResults, menuResults);
            }

            renderSearchResults(restaurants, menuItems) {
                const container = document.getElementById('searchResults');
                container.innerHTML = '';

                if (restaurants.length === 0 && menuItems.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <p class="text-tg-hint">No results found</p>
                        </div>
                    `;
                    return;
                }

                if (restaurants.length > 0) {
                    const section = document.createElement('div');
                    section.innerHTML = '<h3 class="text-lg font-semibold text-tg-text mb-3">Restaurants</h3>';
                    restaurants.forEach(restaurant => {
                        const card = this.createRestaurantCard(restaurant);
                        section.appendChild(card);
                    });
                    container.appendChild(section);
                }

                if (menuItems.length > 0) {
                    const section = document.createElement('div');
                    section.innerHTML = '<h3 class="text-lg font-semibold text-tg-text mb-3 mt-6">Menu Items</h3>';
                    menuItems.forEach(item => {
                        const card = this.createSearchMenuItemCard(item);
                        section.appendChild(card);
                    });
                    container.appendChild(section);
                }
            }

            createSearchMenuItemCard(item) {
                const card = document.createElement('div');
                card.className = 'section-card p-4 mb-3 haptic-feedback cursor-pointer';

                card.innerHTML = `
                    <div class="flex space-x-3">
                        <div class="w-16 h-16 bg-gray-200 rounded-xl overflow-hidden">
                            <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-tg-text">${item.name}</h4>
                            <p class="text-sm text-tg-hint">${item.restaurantName}</p>
                            <p class="text-sm font-semibold text-tg-text">$${item.price.toFixed(2)}</p>
                        </div>
                    </div>
                `;

                card.addEventListener('click', () => {
                    this.hideSearchModal();
                    this.showRestaurantMenu(item.restaurant);
                });

                return card;
            }

            showNotifications() {
                tg.showPopup({
                    title: 'Notifications',
                    message: 'Your order from Mario\'s Pizzeria is being prepared!\n\nEstimated delivery: 25-30 minutes',
                    buttons: [
                        { type: 'ok', text: 'OK' }
                    ]
                });
            }

            showOrderTracking() {
                tg.showPopup({
                    title: 'Order Tracking',
                    message: '🍕 Order Confirmed\n👨‍🍳 Being Prepared\n🚚 Out for Delivery\n📍 Delivered\n\nETA: 25-30 minutes',
                    buttons: [
                        { type: 'ok', text: 'OK' }
                    ]
                });
            }

            showEditProfile() {
                tg.showPopup({
                    title: 'Edit Profile',
                    message: 'Profile editing feature will be available soon. You can update your delivery preferences and payment methods.',
                    buttons: [
                        { type: 'ok', text: 'OK' }
                    ]
                });
            }

            showAddresses() {
                tg.showPopup({
                    title: 'Delivery Addresses',
                    message: 'Manage your saved delivery addresses here. Add home, work, or other frequently used locations for faster checkout.',
                    buttons: [
                        { type: 'ok', text: 'OK' }
                    ]
                });
            }

            showPaymentMethods() {
                tg.showPopup({
                    title: 'Payment Methods',
                    message: 'Add and manage your payment methods. We support credit cards, Telegram Payments, and digital wallets.',
                    buttons: [
                        { type: 'ok', text: 'OK' }
                    ]
                });
            }

            showFavorites() {
                tg.showPopup({
                    title: 'Favorites',
                    message: 'Your favorite restaurants and dishes will appear here. Heart items to add them to your favorites!',
                    buttons: [
                        { type: 'ok', text: 'OK' }
                    ]
                });
            }

            showHelp() {
                tg.showPopup({
                    title: 'Help & Support',
                    message: 'Need help? Contact our support team:\n\n📧 support@foodhub.com\n📞 1-800-FOODHUB\n💬 Live chat available 24/7',
                    buttons: [
                        { type: 'ok', text: 'OK' }
                    ]
                });
            }

            shareApp() {
                const shareText = '🍔 Order delicious food with FoodHub!\n\nDiscover nearby restaurants, browse menus, and get food delivered right to your door. Join me and enjoy amazing meals!\n\nhttps://t.me/your_bot_username/foodhub';
                
                if (navigator.share) {
                    navigator.share({
                        title: 'FoodHub - Order Food Nearby',
                        text: shareText,
                        url: 'https://t.me/your_bot_username/foodhub'
                    });
                } else {
                    navigator.clipboard?.writeText(shareText).then(() => {
                        this.showToast('Share link copied to clipboard!');
                    });
                }
            }

            navigateBack(state) {
                if (state.tab) {
                    this.switchTab(state.tab);
                }
                
                if (this.navigationStack.length === 0) {
                    this.hideBackButton();
                }
            }

            triggerHaptic(type, intensity) {
                if (this.hapticFeedback) {
                    try {
                        if (type === 'impact') {
                            this.hapticFeedback.impactOccurred(intensity || 'medium');
                        } else if (type === 'notification') {
                            this.hapticFeedback.notificationOccurred(intensity || 'success');
                        } else if (type === 'selection') {
                            this.hapticFeedback.selectionChanged();
                        }
                    } catch (e) {
                        console.log('Haptic feedback not available');
                    }
                }
            }

            showToast(message) {
                tg.showAlert(message);
            }

            getTimeAgo(date) {
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (minutes < 1) return 'Just now';
                if (minutes < 60) return `${minutes}m ago`;
                if (hours < 24) return `${hours}h ago`;
                if (days < 7) return `${days}d ago`;
                return date.toLocaleDateString();
            }
        }

        // Initialize the app
        const app = new FoodHubApp();

        // Handle viewport changes
        function handleViewportChange() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        window.addEventListener('resize', handleViewportChange);
        handleViewportChange();

        // Handle online/offline status
        window.addEventListener('online', () => {
            app.showToast('Connection restored');
        });

        window.addEventListener('offline', () => {
            app.showToast('You are offline');
        });

        // Prevent zoom on iOS
        document.addEventListener('gesturestart', (e) => {
            e.preventDefault();
        });
    </script>
</body>
</html>
