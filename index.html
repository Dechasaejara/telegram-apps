<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Food Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A49B7',
                        'telegram': '#0088cc',
                        'telegram-dark': '#0077b5',
                        'yellow-rating': '#FFCA28',
                    },
                    spacing: {
                        '128': '32rem',
                    }
                }
            }
        }
    </script>
    <style>
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-content {
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal.active .modal-content {
            transform: scale(1);
        }
        .rating-stars {
            display: inline-flex;
            direction: rtl;
        }
        .rating-stars input {
            display: none;
        }
        .rating-stars label {
            cursor: pointer;
            color: #ccc;
            transition: color 0.2s;
        }
        .rating-stars label:hover,
        .rating-stars label:hover ~ label,
        .rating-stars input:checked ~ label {
            color: #FFCA28;
        }
        
        /* Restaurant image effects */
        .restaurant-image {
            position: relative;
            overflow: hidden;
        }
        .restaurant-image img {
            transition: transform 0.3s ease;
        }
        .restaurant-image:hover img {
            transform: scale(1.05);
        }
        
        /* Slide in animation for restaurant list */
        @keyframes slideInFromBottom {
            0% {
                transform: translateY(20px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .restaurant-card {
            animation: slideInFromBottom 0.3s ease forwards;
        }
        
        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        
        .dark .skeleton {
            background: linear-gradient(90deg, #2a2a2a 25%, #3a3a3a 50%, #2a2a2a 75%);
            background-size: 200% 100%;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen transition-colors duration-200">
    <div id="app">
        <!-- Main screen (Restaurant List) -->
        <div id="main-screen" class="block">
            <!-- Header with location -->
            <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-10">
                <div class="container mx-auto px-4 py-3">
                    <div class="flex items-center justify-between">
                        <h1 class="text-xl font-bold text-telegram dark:text-blue-400">Food Finder</h1>
                        <div class="flex items-center">
                            <div id="location-display" class="flex items-center text-sm mr-2">
                                <i class="fas fa-location-dot text-primary mr-1"></i>
                                <span id="current-location">Loading location...</span>
                            </div>
                            <button id="refresh-location" class="p-2 text-primary dark:text-primary-dark">
                                <i class="fas fa-arrow-rotate-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search Box -->
                    <div class="relative mt-2">
                        <input type="text" id="search-input" 
                            class="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 
                            dark:bg-gray-700 text-base focus:outline-none focus:ring-2 focus:ring-primary" 
                            placeholder="Search restaurants, cuisines...">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                    
                    <!-- Filter options -->
                    <div class="flex space-x-2 mt-3 pb-1 overflow-x-auto hide-scrollbar">
                        <button class="filter-btn active whitespace-nowrap px-3 py-1 rounded-full text-sm bg-primary text-white" data-filter="all">
                            All
                        </button>
                        <button class="filter-btn whitespace-nowrap px-3 py-1 rounded-full text-sm bg-gray-200 dark:bg-gray-700" data-filter="fastfood">
                            Fast Food
                        </button>
                        <button class="filter-btn whitespace-nowrap px-3 py-1 rounded-full text-sm bg-gray-200 dark:bg-gray-700" data-filter="italian">
                            Italian
                        </button>
                        <button class="filter-btn whitespace-nowrap px-3 py-1 rounded-full text-sm bg-gray-200 dark:bg-gray-700" data-filter="asian">
                            Asian
                        </button>
                        <button class="filter-btn whitespace-nowrap px-3 py-1 rounded-full text-sm bg-gray-200 dark:bg-gray-700" data-filter="cafe">
                            Café
                        </button>
                        <button class="filter-btn whitespace-nowrap px-3 py-1 rounded-full text-sm bg-gray-200 dark:bg-gray-700" data-filter="desserts">
                            Desserts
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Restaurant List -->
            <div class="container mx-auto px-4 py-4">
                <div id="restaurant-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Restaurants will be loaded here -->
                    <!-- Loading Skeletons -->
                    <div class="skeleton-card rounded-lg shadow-md overflow-hidden bg-white dark:bg-gray-800">
                        <div class="skeleton h-48 w-full"></div>
                        <div class="p-4">
                            <div class="skeleton h-6 w-3/4 rounded mb-2"></div>
                            <div class="skeleton h-4 w-1/2 rounded mb-3"></div>
                            <div class="skeleton h-4 w-full rounded mb-2"></div>
                            <div class="skeleton h-4 w-2/3 rounded"></div>
                        </div>
                    </div>
                    <div class="skeleton-card rounded-lg shadow-md overflow-hidden bg-white dark:bg-gray-800">
                        <div class="skeleton h-48 w-full"></div>
                        <div class="p-4">
                            <div class="skeleton h-6 w-3/4 rounded mb-2"></div>
                            <div class="skeleton h-4 w-1/2 rounded mb-3"></div>
                            <div class="skeleton h-4 w-full rounded mb-2"></div>
                            <div class="skeleton h-4 w-2/3 rounded"></div>
                        </div>
                    </div>
                </div>
                
                <!-- No results message -->
                <div id="no-results" class="hidden text-center py-8">
                    <i class="fas fa-search text-4xl text-gray-400 mb-3"></i>
                    <p class="text-gray-500 dark:text-gray-400">No restaurants found matching your criteria.</p>
                    <button id="clear-filters" class="mt-2 text-primary">Clear filters</button>
                </div>
            </div>
        </div>
        
        <!-- Restaurant Detail Screen -->
        <div id="detail-screen" class="hidden">
            <!-- Detail Header -->
            <div class="relative">
                <div id="restaurant-cover" class="h-48 md:h-72 bg-gray-300 dark:bg-gray-700 bg-center bg-cover">
                    <!-- Restaurant cover image will be set via JS -->
                </div>
                <button id="back-to-list" class="absolute top-4 left-4 bg-black bg-opacity-50 text-white p-2 rounded-full">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4 text-white">
                    <h1 id="detail-name" class="text-2xl font-bold mb-1">Restaurant Name</h1>
                    <div class="flex items-center">
                        <div id="detail-rating" class="flex items-center mr-3">
                            <i class="fas fa-star text-yellow-rating mr-1"></i>
                            <span>4.5</span>
                        </div>
                        <div id="detail-cuisine" class="text-sm">Cuisine</div>
                    </div>
                </div>
            </div>
            
            <!-- Restaurant Info -->
            <div class="container mx-auto px-4 py-4">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4">
                    <div class="flex flex-wrap gap-4 mb-2">
                        <div class="flex items-center">
                            <i class="fas fa-location-dot text-primary mr-2"></i>
                            <span id="detail-distance" class="text-sm">1.2 km away</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-clock text-primary mr-2"></i>
                            <span id="detail-hours" class="text-sm">Open until 10:00 PM</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-phone text-primary mr-2"></i>
                            <a id="detail-phone" href="tel:" class="text-sm">+1234567890</a>
                        </div>
                    </div>
                    <p id="detail-description" class="text-gray-600 dark:text-gray-300 mb-3">
                        Restaurant description will be placed here.
                    </p>
                    <div class="flex space-x-2">
                        <button id="share-restaurant" class="flex-1 bg-telegram hover:bg-telegram-dark text-white py-2 px-4 rounded-md flex justify-center items-center">
                            <i class="fas fa-share-alt mr-2"></i>Share
                        </button>
                        <button id="view-location" class="flex-1 bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-md flex justify-center items-center">
                            <i class="fas fa-map-marker-alt mr-2"></i>View Map
                        </button>
                    </div>
                </div>
                
                <!-- Menu Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4">
                    <h2 class="text-xl font-bold mb-3">Menu</h2>
                    <div id="menu-categories" class="flex space-x-2 mb-3 overflow-x-auto pb-1">
                        <!-- Menu categories will be added here -->
                    </div>
                    <div id="menu-items" class="space-y-3">
                        <!-- Menu items will be added here -->
                    </div>
                </div>
                
                <!-- Reviews Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-xl font-bold">Reviews</h2>
                        <button id="add-review" class="bg-primary hover:bg-primary-dark text-white py-1 px-3 rounded-md text-sm">
                            Write a Review
                        </button>
                    </div>
                    <div id="review-list" class="space-y-3">
                        <!-- Reviews will be added here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Review Form Modal -->
        <div id="review-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 opacity-0 invisible">
            <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full mx-4">
                <div class="p-6">
                    <h3 class="text-xl font-semibold mb-4">Write a Review</h3>
                    <form id="review-form">
                        <input type="hidden" id="review-restaurant-id">
                        <input type="hidden" id="review-user-id">
                        
                        <div class="mb-4 text-center">
                            <div class="text-base mb-2">Rate your experience</div>
                            <div class="rating-stars text-2xl">
                                <input type="radio" id="star5" name="rating" value="5" />
                                <label for="star5" class="px-1"><i class="fas fa-star"></i></label>
                                <input type="radio" id="star4" name="rating" value="4" />
                                <label for="star4" class="px-1"><i class="fas fa-star"></i></label>
                                <input type="radio" id="star3" name="rating" value="3" />
                                <label for="star3" class="px-1"><i class="fas fa-star"></i></label>
                                <input type="radio" id="star2" name="rating" value="2" />
                                <label for="star2" class="px-1"><i class="fas fa-star"></i></label>
                                <input type="radio" id="star1" name="rating" value="1" />
                                <label for="star1" class="px-1"><i class="fas fa-star"></i></label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="review-title" class="block text-gray-700 dark:text-gray-300 mb-1">Title</label>
                            <input type="text" id="review-title" class="w-full px-3 py-2 border rounded-md text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required placeholder="Summarize your experience">
                        </div>
                        
                        <div class="mb-4">
                            <label for="review-text" class="block text-gray-700 dark:text-gray-300 mb-1">Your Review</label>
                            <textarea id="review-text" rows="4" class="w-full px-3 py-2 border rounded-md text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required placeholder="Tell others about your experience"></textarea>
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button type="button" class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg">Cancel</button>
                            <button type="submit" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg">Submit Review</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check for dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // App State
        const appState = {
            userLocation: null,
            currentRestaurant: null,
            userProfile: {
                id: 'user123', // In a real app, this would come from Telegram
                name: 'John Doe',
                photo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f466.png'
            },
            restaurants: [],
            reviews: [],
            activeFilter: 'all',
            searchQuery: '',
            activeMenuCategory: 'all'
        };

        // Simulate loading restaurants near the user
        function loadSampleData() {
            // Sample data for restaurants
            appState.restaurants = [
                {
                    id: 1,
                    name: "Burger King",
                    cuisine: "Fast Food",
                    cuisineType: "fastfood",
                    description: "Classic burger joint offering flame-grilled burgers, fries, and milkshakes in a casual setting.",
                    distance: 0.3,
                    rating: 4.2,
                    reviewCount: 128,
                    hours: "09:00 AM - 11:00 PM",
                    phone: "+1-555-123-4567",
                    image: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f354.png",
                    location: { lat: 40.7128, lng: -74.0060 },
                    menu: [
                        { category: "Burgers", items: [
                            { name: "Whopper", price: 5.99, description: "Flame-grilled beef patty topped with tomatoes, lettuce, mayo, ketchup, pickles, and onions." },
                            { name: "Bacon King", price: 7.99, description: "Double flame-grilled beef patties with bacon, cheese, ketchup and mayo." },
                            { name: "Chicken Royale", price: 6.49, description: "Crispy chicken patty with lettuce and mayo in a long sesame seed bun." }
                        ]},
                        { category: "Sides", items: [
                            { name: "French Fries", price: 2.99, description: "Crispy, golden french fries." },
                            { name: "Onion Rings", price: 3.49, description: "Crispy, fried onion rings." }
                        ]},
                        { category: "Drinks", items: [
                            { name: "Soft Drink", price: 1.99, description: "Choice of soft drinks." },
                            { name: "Milkshake", price: 3.99, description: "Creamy milkshakes in various flavors." }
                        ]}
                    ]
                },
                {
                    id: 2,
                    name: "Pizza Paradise",
                    cuisine: "Italian",
                    cuisineType: "italian",
                    description: "Authentic Italian pizzas made in a wood-fired oven with fresh, locally-sourced ingredients.",
                    distance: 0.7,
                    rating: 4.8,
                    reviewCount: 205,
                    hours: "11:00 AM - 10:00 PM",
                    phone: "+1-555-678-9012",
                    image: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f355.png",
                    location: { lat: 40.7228, lng: -74.0060 },
                    menu: [
                        { category: "Pizzas", items: [
                            { name: "Margherita", price: 12.99, description: "Tomato sauce, mozzarella, and fresh basil." },
                            { name: "Pepperoni", price: 14.99, description: "Tomato sauce, mozzarella, and pepperoni." },
                            { name: "Vegetarian", price: 13.99, description: "Tomato sauce, mozzarella, bell peppers, mushrooms, and olives." }
                        ]},
                        { category: "Pasta", items: [
                            { name: "Spaghetti Carbonara", price: 14.99, description: "Spaghetti with egg, pecorino romano, pancetta, and black pepper." },
                            { name: "Penne Arrabbiata", price: 13.99, description: "Penne with spicy tomato sauce." }
                        ]},
                        { category: "Desserts", items: [
                            { name: "Tiramisu", price: 6.99, description: "Coffee-flavoured Italian dessert made of ladyfingers dipped in coffee, layered with a whipped mixture of eggs, sugar, and mascarpone cheese." }
                        ]}
                    ]
                },
                {
                    id: 3,
                    name: "Sushi Palace",
                    cuisine: "Japanese",
                    cuisineType: "asian",
                    description: "Premium sushi restaurant offering the freshest fish and authentic Japanese dishes in an elegant atmosphere.",
                    distance: 1.2,
                    rating: 4.7,
                    reviewCount: 162,
                    hours: "12:00 PM - 10:30 PM",
                    phone: "+1-555-456-7890",
                    image: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f363.png",
                    location: { lat: 40.7328, lng: -74.0160 },
                    menu: [
                        { category: "Sushi", items: [
                            { name: "Salmon Nigiri (2pc)", price: 5.99, description: "Fresh salmon on hand-pressed sushi rice." },
                            { name: "Tuna Nigiri (2pc)", price: 6.99, description: "Fresh tuna on hand-pressed sushi rice." },
                            { name: "California Roll (6pc)", price: 7.99, description: "Crab, avocado, and cucumber." }
                        ]},
                        { category: "Sashimi", items: [
                            { name: "Salmon Sashimi (5pc)", price: 10.99, description: "Thinly sliced fresh salmon." },
                            { name: "Tuna Sashimi (5pc)", price: 12.99, description: "Thinly sliced fresh tuna." }
                        ]},
                        { category: "Bento", items: [
                            { name: "Chicken Teriyaki Bento", price: 16.99, description: "Chicken teriyaki, rice, salad, gyoza, and miso soup." }
                        ]}
                    ]
                },
                {
                    id: 4,
                    name: "Café Mocha",
                    cuisine: "Café",
                    cuisineType: "cafe",
                    description: "Cozy café serving specialty coffees, teas, and homemade pastries in a relaxed environment. Free Wi-Fi available.",
                    distance: 0.5,
                    rating: 4.5,
                    reviewCount: 93,
                    hours: "07:00 AM - 08:00 PM",
                    phone: "+1-555-234-5678",
                    image: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/2615.png",
                    location: { lat: 40.7228, lng: -74.0160 },
                    menu: [
                        { category: "Coffee", items: [
                            { name: "Espresso", price: 2.99, description: "Strong black coffee made by forcing steam through ground coffee beans." },
                            { name: "Cappuccino", price: 4.49, description: "Espresso with steamed milk and foam." },
                            { name: "Latte", price: 4.99, description: "Espresso with steamed milk." }
                        ]},
                        { category: "Pastries", items: [
                            { name: "Butter Croissant", price: 3.49, description: "Flaky, buttery pastry." },
                            { name: "Blueberry Muffin", price: 3.99, description: "Moist muffin filled with blueberries." }
                        ]},
                        { category: "Sandwiches", items: [
                            { name: "Avocado Toast", price: 7.99, description: "Smashed avocado on multigrain toast with sea salt and red pepper flakes." }
                        ]}
                    ]
                },
                {
                    id: 5,
                    name: "Sweet Delights",
                    cuisine: "Desserts",
                    cuisineType: "desserts",
                    description: "A heaven for dessert lovers with a wide range of cakes, pastries, ice creams, and more.",
                    distance: 0.9,
                    rating: 4.9,
                    reviewCount: 178,
                    hours: "10:00 AM - 09:00 PM",
                    phone: "+1-555-890-1234",
                    image: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f370.png",
                    location: { lat: 40.7428, lng: -74.0260 },
                    menu: [
                        { category: "Cakes", items: [
                            { name: "Chocolate Cake", price: 6.99, description: "Rich chocolate cake with chocolate ganache." },
                            { name: "Cheesecake", price: 7.99, description: "Creamy cheesecake with graham cracker crust." },
                            { name: "Red Velvet", price: 7.49, description: "Moist red velvet cake with cream cheese frosting." }
                        ]},
                        { category: "Ice Cream", items: [
                            { name: "Vanilla (1 scoop)", price: 3.49, description: "Classic vanilla ice cream." },
                            { name: "Chocolate (1 scoop)", price: 3.49, description: "Rich chocolate ice cream." }
                        ]},
                        { category: "Pastries", items: [
                            { name: "Éclair", price: 4.99, description: "Chocolate-covered pastry filled with cream." }
                        ]}
                    ]
                },
                {
                    id: 6,
                    name: "Thai Taste",
                    cuisine: "Thai",
                    cuisineType: "asian",
                    description: "Authentic Thai cuisine with a modern twist. From pad thai to curry dishes, experience the flavors of Thailand.",
                    distance: 1.5,
                    rating: 4.6,
                    reviewCount: 145,
                    hours: "11:30 AM - 10:00 PM",
                    phone: "+1-555-345-6789",
                    image: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f35b.png",
                    location: { lat: 40.7528, lng: -74.0360 },
                    menu: [
                        { category: "Starters", items: [
                            { name: "Spring Rolls (4pc)", price: 6.99, description: "Vegetable filled crispy spring rolls with sweet chili sauce." },
                            { name: "Chicken Satay (4pc)", price: 8.99, description: "Grilled chicken skewers with peanut sauce." }
                        ]},
                        { category: "Main Courses", items: [
                            { name: "Pad Thai", price: 14.99, description: "Stir-fried rice noodles with tofu, shrimp, peanuts, and bean sprouts." },
                            { name: "Green Curry", price: 15.99, description: "Spicy curry with coconut milk, bamboo shoots, and basil." }
                        ]},
                        { category: "Desserts", items: [
                            { name: "Mango Sticky Rice", price: 7.99, description: "Sweet sticky rice with fresh mango and coconut cream." }
                        ]}
                    ]
                }
            ];

            // Sample reviews
            appState.reviews = [
                {
                    id: 1,
                    restaurantId: 1,
                    userId: "user123",
                    userName: "John Doe",
                    userPhoto: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f466.png",
                    rating: 4,
                    title: "Great burgers",
                    text: "The Whopper was delicious and the service was fast.",
                    date: new Date('2023-05-15')
                },
                {
                    id: 2,
                    restaurantId: 1,
                    userId: "user456",
                    userName: "Jane Smith",
                    userPhoto: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f467.png",
                    rating: 5,
                    title: "Best fast food place",
                    text: "Always consistent quality and quick service.",
                    date: new Date('2023-06-20')
                },
                {
                    id: 3,
                    restaurantId: 2,
                    userId: "user789",
                    userName: "Mike Johnson",
                    userPhoto: "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f468.png",
                    rating: 5,
                    title: "Authentic Italian Pizza",
                    text: "Reminds me of the pizza I had in Naples. Truly authentic and delicious!",
                    date: new Date('2023-07-10')
                }
            ];
        }

        // DOM Elements
        const mainScreen = document.getElementById('main-screen');
        const detailScreen = document.getElementById('detail-screen');
        const reviewModal = document.getElementById('review-modal');
        const restaurantList = document.getElementById('restaurant-list');
        const currentLocation = document.getElementById('current-location');
        const noResults = document.getElementById('no-results');
        const menuCategories = document.getElementById('menu-categories');
        const menuItems = document.getElementById('menu-items');
        const reviewList = document.getElementById('review-list');

        // Event Listeners
        document.getElementById('back-to-list').addEventListener('click', showMainScreen);
        document.getElementById('add-review').addEventListener('click', showReviewModal);
        document.getElementById('share-restaurant').addEventListener('click', shareRestaurant);
        document.getElementById('view-location').addEventListener('click', viewRestaurantLocation);
        document.getElementById('refresh-location').addEventListener('click', getUserLocation);
        document.getElementById('clear-filters').addEventListener('click', clearFilters);
        document.getElementById('search-input').addEventListener('input', handleSearch);

        // Close modals
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', () => {
                hideModal(reviewModal);
            });
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', () => {
                const filter = button.dataset.filter;
                appState.activeFilter = filter;
                
                // Update button styles
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    if (btn.dataset.filter === filter) {
                        btn.classList.add('bg-primary', 'text-white');
                        btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    } else {
                        btn.classList.remove('bg-primary', 'text-white');
                        btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                    }
                });
                
                renderRestaurants();
            });
        });

        // Review Form submission
        document.getElementById('review-form').addEventListener('submit', (e) => {
            e.preventDefault();
            submitReview();
        });

        // Utility Functions
        function showModal(modal) {
            modal.classList.remove('opacity-0', 'invisible');
            modal.classList.add('active');
            setTimeout(() => {
                modal.querySelector('input')?.focus();
            }, 300);
        }

        function hideModal(modal) {
            modal.classList.remove('active');
            modal.classList.add('opacity-0', 'invisible');
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // App Functions
        function initApp() {
            loadSampleData();
            getUserLocation();
            renderRestaurants();
        }

        function getUserLocation() {
            currentLocation.textContent = "Getting location...";
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        appState.userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        currentLocation.textContent = "Your Location";
                        // In a real app, we would fetch restaurants near this location
                        // For demo, we just show the sample data
                        renderRestaurants();
                    },
                    (error) => {
                        console.error("Error getting location:", error);
                        currentLocation.textContent = "Location unavailable";
                        // Still render sample data for demo
                        renderRestaurants();
                    },
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
            } else {
                currentLocation.textContent = "Geolocation not supported";
                renderRestaurants();
            }
        }

        function renderRestaurants() {
            // Clear skeleton loaders
            document.querySelectorAll('.skeleton-card').forEach(card => card.remove());
            
            let filteredRestaurants = appState.restaurants;
            
            // Apply cuisine filter
            if (appState.activeFilter !== 'all') {
                filteredRestaurants = filteredRestaurants.filter(
                    restaurant => restaurant.cuisineType === appState.activeFilter
                );
            }
            
            // Apply search filter
            if (appState.searchQuery) {
                const query = appState.searchQuery.toLowerCase();
                filteredRestaurants = filteredRestaurants.filter(restaurant => 
                    restaurant.name.toLowerCase().includes(query) || 
                    restaurant.cuisine.toLowerCase().includes(query) ||
                    restaurant.description.toLowerCase().includes(query)
                );
            }
            
            // Sort by distance
            filteredRestaurants = [...filteredRestaurants].sort((a, b) => a.distance - b.distance);
            
            // Check if we have any results
            if (filteredRestaurants.length === 0) {
                restaurantList.innerHTML = '';
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
                
                restaurantList.innerHTML = '';
                filteredRestaurants.forEach((restaurant, index) => {
                    const card = document.createElement('div');
                    card.className = 'restaurant-card rounded-lg shadow-md overflow-hidden bg-white dark:bg-gray-800';
                    card.style.animationDelay = `${index * 0.05}s`;
                    
                    const reviewsForRestaurant = appState.reviews.filter(r => r.restaurantId === restaurant.id);
                    
                    card.innerHTML = `
                        <div class="restaurant-image h-48 bg-gray-200 dark:bg-gray-700">
                            <img src="${restaurant.image}" alt="${restaurant.name}" 
                                class="w-full h-full object-cover">
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-lg">${restaurant.name}</h3>
                                <div class="flex items-center bg-yellow-rating bg-opacity-20 px-2 py-1 rounded">
                                    <i class="fas fa-star text-yellow-rating mr-1"></i>
                                    <span>${restaurant.rating}</span>
                                    <span class="text-xs text-gray-500 dark:text-gray-400 ml-1">(${restaurant.reviewCount})</span>
                                </div>
                            </div>
                            <div class="flex items-center mt-1 mb-2">
                                <span class="text-gray-600 dark:text-gray-300 text-sm">${restaurant.cuisine}</span>
                                <span class="mx-2">•</span>
                                <span class="text-gray-600 dark:text-gray-300 text-sm">${restaurant.distance} km away</span>
                            </div>
                            <p class="text-gray-500 dark:text-gray-400 text-sm line-clamp-2">${restaurant.description}</p>
                            <div class="mt-3 flex justify-between items-center">
                                <span class="text-primary text-sm">${restaurant.hours}</span>
                                <button class="view-restaurant-btn px-3 py-1 rounded-full bg-primary text-white text-sm hover:bg-primary-dark" 
                                    data-id="${restaurant.id}">View Menu</button>
                            </div>
                        </div>
                    `;
                    
                    restaurantList.appendChild(card);
                    
                    // Add event listener to view restaurant button
                    card.querySelector('.view-restaurant-btn').addEventListener('click', () => {
                        showRestaurantDetails(restaurant.id);
                    });
                });
            }
        }

        function showRestaurantDetails(restaurantId) {
            const restaurant = appState.restaurants.find(r => r.id === restaurantId);
            if (!restaurant) return;
            
            appState.currentRestaurant = restaurant;
            
            // Set restaurant details
            document.getElementById('restaurant-cover').style.backgroundImage = `url(${restaurant.image})`;
            document.getElementById('detail-name').textContent = restaurant.name;
            document.getElementById('detail-rating').innerHTML = `
                <i class="fas fa-star text-yellow-rating mr-1"></i>
                <span>${restaurant.rating} (${restaurant.reviewCount})</span>
            `;
            document.getElementById('detail-cuisine').textContent = restaurant.cuisine;
            document.getElementById('detail-distance').textContent = `${restaurant.distance} km away`;
            document.getElementById('detail-hours').textContent = restaurant.hours;
            document.getElementById('detail-phone').textContent = restaurant.phone;
            document.getElementById('detail-phone').href = `tel:${restaurant.phone}`;
            document.getElementById('detail-description').textContent = restaurant.description;
            
            // Render menu categories
            renderMenuCategories(restaurant);
            
            // Render menu items (starting with first category or all)
            appState.activeMenuCategory = 'all';
            renderMenuItems(restaurant);
            
            // Render reviews
            renderReviews(restaurant.id);
            
            // Switch screens
            mainScreen.classList.add('hidden');
            detailScreen.classList.remove('hidden');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        function renderMenuCategories(restaurant) {
            menuCategories.innerHTML = `
                <button class="menu-category-btn whitespace-nowrap px-3 py-1 rounded-full text-sm bg-primary text-white active" 
                    data-category="all">All</button>
            `;
            
            // Extract unique categories
            const categories = restaurant.menu.map(item => item.category);
            
            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'menu-category-btn whitespace-nowrap px-3 py-1 rounded-full text-sm bg-gray-200 dark:bg-gray-700';
                btn.setAttribute('data-category', category);
                btn.textContent = category;
                menuCategories.appendChild(btn);
                
                // Add event listener
                btn.addEventListener('click', () => {
                    appState.activeMenuCategory = category;
                    
                    // Update button styles
                    document.querySelectorAll('.menu-category-btn').forEach(el => {
                        if (el.dataset.category === category) {
                            el.classList.add('bg-primary', 'text-white');
                            el.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                        } else {
                            el.classList.remove('bg-primary', 'text-white');
                            el.classList.add('bg-gray-200', 'dark:bg-gray-700');
                        }
                    });
                    
                    renderMenuItems(restaurant);
                });
            });
            
            // Add event listener to "All" button
            document.querySelector('.menu-category-btn[data-category="all"]').addEventListener('click', () => {
                appState.activeMenuCategory = 'all';
                
                // Update button styles
                document.querySelectorAll('.menu-category-btn').forEach(el => {
                    if (el.dataset.category === 'all') {
                        el.classList.add('bg-primary', 'text-white');
                        el.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    } else {
                        el.classList.remove('bg-primary', 'text-white');
                        el.classList.add('bg-gray-200', 'dark:bg-gray-700');
                    }
                });
                
                renderMenuItems(restaurant);
            });
        }

        function renderMenuItems(restaurant) {
            menuItems.innerHTML = '';
            
            restaurant.menu.forEach(category => {
                // Skip if not matching the active category filter
                if (appState.activeMenuCategory !== 'all' && category.category !== appState.activeMenuCategory) {
                    return;
                }
                
                // Add category title if showing all categories
                if (appState.activeMenuCategory === 'all') {
                    const categoryTitle = document.createElement('h3');
                    categoryTitle.className = 'font-semibold text-lg mt-4 mb-2';
                    categoryTitle.textContent = category.category;
                    menuItems.appendChild(categoryTitle);
                }
                
                // Add menu items
                category.items.forEach(item => {
                    const menuItem = document.createElement('div');
                    menuItem.className = 'flex justify-between border-b dark:border-gray-700 pb-2 last:border-0';
                    menuItem.innerHTML = `
                        <div>
                            <div class="font-medium">${item.name}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">${item.description}</div>
                        </div>
                        <div class="text-primary font-semibold whitespace-nowrap ml-2">$${item.price.toFixed(2)}</div>
                    `;
                    menuItems.appendChild(menuItem);
                });
            });
        }

        function renderReviews(restaurantId) {
            const restaurantReviews = appState.reviews.filter(review => review.restaurantId === restaurantId);
            reviewList.innerHTML = '';
            
            if (restaurantReviews.length === 0) {
                reviewList.innerHTML = `
                    <div class="text-center py-4 text-gray-500 dark:text-gray-400">
                        <p>No reviews yet. Be the first to write one!</p>
                    </div>
                `;
                return;
            }
            
            restaurantReviews.forEach(review => {
                const reviewItem = document.createElement('div');
                reviewItem.className = 'border-b dark:border-gray-700 pb-3 last:border-0';
                
                // Generate star rating HTML
                let starsHtml = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= review.rating) {
                        starsHtml += '<i class="fas fa-star text-yellow-rating"></i>';
                    } else {
                        starsHtml += '<i class="far fa-star text-gray-300 dark:text-gray-600"></i>';
                    }
                }
                
                reviewItem.innerHTML = `
                    <div class="flex items-start">
                        <img src="${review.userPhoto}" alt="${review.userName}" class="w-10 h-10 rounded-full mr-3">
                        <div class="flex-1">
                            <div class="flex justify-between items-center">
                                <h4 class="font-medium">${review.userName}</h4>
                                <span class="text-sm text-gray-500 dark:text-gray-400">${formatDate(review.date)}</span>
                            </div>
                            <div class="flex items-center my-1">
                                <div class="text-sm">${starsHtml}</div>
                            </div>
                            <div class="font-medium mb-1">${review.title}</div>
                            <p class="text-gray-600 dark:text-gray-300 text-sm">${review.text}</p>
                        </div>
                    </div>
                `;
                
                reviewList.appendChild(reviewItem);
            });
        }

        function showMainScreen() {
            detailScreen.classList.add('hidden');
            mainScreen.classList.remove('hidden');
        }

        function showReviewModal() {
            if (!appState.currentRestaurant) return;
            
            // Reset form
            document.getElementById('review-restaurant-id').value = appState.currentRestaurant.id;
            document.getElementById('review-user-id').value = appState.userProfile.id;
            document.getElementById('review-title').value = '';
            document.getElementById('review-text').value = '';
            document.querySelector('input[name="rating"]:checked')?.removeAttribute('checked');
            
            showModal(reviewModal);
        }

        function submitReview() {
            const restaurantId = parseInt(document.getElementById('review-restaurant-id').value);
            const userId = document.getElementById('review-user-id').value;
            const rating = parseInt(document.querySelector('input[name="rating"]:checked')?.value || '5');
            const title = document.getElementById('review-title').value.trim();
            const text = document.getElementById('review-text').value.trim();
            
            if (!title || !text) return;
            
            // Create new review
            const newReview = {
                id: Math.max(0, ...appState.reviews.map(r => r.id)) + 1,
                restaurantId,
                userId,
                userName: appState.userProfile.name,
                userPhoto: appState.userProfile.photo,
                rating,
                title,
                text,
                date: new Date()
            };
            
            // Add to reviews
            appState.reviews.push(newReview);
            
            // Update restaurant rating
            updateRestaurantRating(restaurantId);
            
            // Close modal
            hideModal(reviewModal);
            
            // Render updated reviews
            renderReviews(restaurantId);
        }

        function updateRestaurantRating(restaurantId) {
            const restaurant = appState.restaurants.find(r => r.id === restaurantId);
            if (!restaurant) return;
            
            const restaurantReviews = appState.reviews.filter(r => r.restaurantId === restaurantId);
            const reviewCount = restaurantReviews.length;
            
            if (reviewCount === 0) return;
            
            // Calculate average rating
            const totalRating = restaurantReviews.reduce((sum, review) => sum + review.rating, 0);
            const avgRating = totalRating / reviewCount;
            
            // Update restaurant
            restaurant.rating = parseFloat(avgRating.toFixed(1));
            restaurant.reviewCount = reviewCount;
            
            // Update UI
            document.getElementById('detail-rating').innerHTML = `
                <i class="fas fa-star text-yellow-rating mr-1"></i>
                <span>${restaurant.rating} (${restaurant.reviewCount})</span>
            `;
        }

        function shareRestaurant() {
            if (!appState.currentRestaurant) return;
            
            // In a real Telegram Mini App, we would use Telegram's native
            // sharing functionality. For this demo, we'll simulate it with an alert.
            const restaurant = appState.currentRestaurant;
            const shareText = `Check out ${restaurant.name} - ${restaurant.cuisine} restaurant, rated ${restaurant.rating}/5!`;
            
            // This would be replaced with Telegram's native sharing API
            // For demo purposes, let's assume we're calling Telegram's WebApp API
            try {
                // In a real app, we would use window.Telegram.WebApp.showPopup
                alert(`Sharing: ${shareText}`);
            } catch (error) {
                console.error("Error sharing:", error);
            }
        }

        function viewRestaurantLocation() {
            if (!appState.currentRestaurant) return;
            
            // In a real app, this would open the location in Telegram's map viewer
            // or use a map API to show the location
            const restaurant = appState.currentRestaurant;
            alert(`Viewing location for ${restaurant.name} at coordinates: ${restaurant.location.lat}, ${restaurant.location.lng}`);
        }

        function handleSearch(e) {
            appState.searchQuery = e.target.value.trim();
            renderRestaurants();
        }

        function clearFilters() {
            appState.activeFilter = 'all';
            appState.searchQuery = '';
            
            // Reset search input
            document.getElementById('search-input').value = '';
            
            // Reset filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.filter === 'all') {
                    btn.classList.add('bg-primary', 'text-white');
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                } else {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                }
            });
            
            renderRestaurants();
        }

        // Initialize the app
        initApp();
    </script>
</body>
</html>