<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Connection Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: 'var(--tg-theme-button-color, #5D5CDE)',
                            text: 'var(--tg-theme-button-text-color, #FFFFFF)',
                        },
                        bg: {
                            DEFAULT: 'var(--tg-theme-bg-color, #FFFFFF)',
                            secondary: 'var(--tg-theme-secondary-bg-color, #F5F5F5)',
                        },
                        text: {
                            DEFAULT: 'var(--tg-theme-text-color, #222222)',
                            secondary: 'var(--tg-theme-hint-color, #999999)',
                            link: 'var(--tg-theme-link-color, #5D5CDE)',
                        },
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'slide-in-right': 'slideInRight 0.3s ease-out forwards',
                        'slide-out-left': 'slideOutLeft 0.3s ease-in forwards',
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                        'fade-out': 'fadeOut 0.3s ease-in forwards',
                    },
                    keyframes: {
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        slideOutLeft: {
                            '0%': { transform: 'translateX(0)', opacity: '1' },
                            '100%': { transform: 'translateX(-100%)', opacity: '0' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        fadeOut: {
                            '0%': { opacity: '1' },
                            '100%': { opacity: '0' }
                        }
                    }
                }
            }
        };
    </script>
    <style>
        /* Telegram WebApp bridge styles */
        :root {
            --safe-area-top: env(safe-area-inset-top, 0px);
            --safe-area-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-left: env(safe-area-inset-left, 0px);
            --safe-area-right: env(safe-area-inset-right, 0px);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 0;
            margin: 0;
            color: var(--tg-theme-text-color, #222222);
            background-color: var(--tg-theme-bg-color, #ffffff);
        }
        
        .skeleton {
            position: relative;
            overflow: hidden;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }
        
        .skeleton::after {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            transform: translateX(-100%);
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0) 0%, 
                rgba(255, 255, 255, 0.2) 20%, 
                rgba(255, 255, 255, 0.5) 60%, 
                rgba(255, 255, 255, 0));
            animation: shimmer 2s infinite;
            content: '';
        }
        
        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--tg-theme-hint-color, #999999);
            border-radius: 3px;
        }

        /* Swipe Card Animation */
        .swipe-card {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .swipe-card.swipe-left {
            transform: translateX(-150%) rotate(-20deg);
            opacity: 0;
        }
        
        .swipe-card.swipe-right {
            transform: translateX(150%) rotate(20deg);
            opacity: 0;
        }

        /* Badge styles */
        .badge-unlocked {
            filter: grayscale(0);
            transform: scale(1);
            transition: all 0.3s ease;
        }
        
        .badge-locked {
            filter: grayscale(1);
            transform: scale(0.9);
            opacity: 0.6;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">
    <!-- App Container -->
    <div id="app" class="flex flex-col h-full w-full overflow-hidden">
        <!-- Header -->
        <header id="app-header" class="flex items-center justify-between px-4 py-3 border-b border-bg-secondary">
            <div class="flex items-center">
                <button id="back-button" class="hidden mr-2 p-2 rounded-full hover:bg-bg-secondary active:bg-bg-secondary transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
                <h1 id="header-title" class="text-lg font-semibold">Connection Quest</h1>
            </div>
            <div class="flex items-center space-x-2">
                <button id="filter-button" class="hidden p-2 rounded-full hover:bg-bg-secondary active:bg-bg-secondary transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                    </svg>
                </button>
                <button id="notification-button" class="hidden p-2 rounded-full hover:bg-bg-secondary active:bg-bg-secondary transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 overflow-hidden relative">
            <!-- Screens Container -->
            <div id="screens" class="h-full w-full relative">
                <!-- Loading Screen -->
                <section id="loading-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-bg z-50">
                    <div class="w-16 h-16 mb-4 rounded-full border-4 border-primary border-t-transparent animate-spin"></div>
                    <p class="text-text-secondary">Loading your experience...</p>
                </section>
                
                <!-- Onboarding Screen -->
                <section id="onboarding-screen" class="absolute inset-0 flex flex-col items-center justify-center p-4 hidden">
                    <div class="flex flex-col items-center max-w-md mx-auto text-center">
                        <div id="user-avatar" class="w-24 h-24 mb-4 rounded-full bg-bg-secondary flex items-center justify-center overflow-hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-text-secondary" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <h2 id="welcome-text" class="text-2xl font-bold mb-2">Welcome to Connection Quest!</h2>
                        <p class="text-text-secondary mb-6">Find meaningful connections based on shared activities and values.</p>
                        
                        <div class="w-full mb-8">
                            <form id="onboarding-form" class="space-y-4">
                                <div class="space-y-2">
                                    <label for="gender" class="block text-left text-sm font-medium">I am a</label>
                                    <select id="gender" class="w-full text-base px-4 py-3 rounded-lg bg-bg-secondary border-none">
                                        <option value="">Select gender</option>
                                        <option value="male">Man</option>
                                        <option value="female">Woman</option>
                                        <option value="non-binary">Non-binary</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="space-y-2">
                                    <label for="interested-in" class="block text-left text-sm font-medium">Interested in</label>
                                    <select id="interested-in" class="w-full text-base px-4 py-3 rounded-lg bg-bg-secondary border-none">
                                        <option value="">Select preference</option>
                                        <option value="male">Men</option>
                                        <option value="female">Women</option>
                                        <option value="everyone">Everyone</option>
                                    </select>
                                </div>
                                
                                <div class="space-y-2">
                                    <label for="age" class="block text-left text-sm font-medium">Age</label>
                                    <input type="number" id="age" min="18" max="100" class="w-full text-base px-4 py-3 rounded-lg bg-bg-secondary border-none" placeholder="Your age">
                                </div>
                                
                                <div class="space-y-2">
                                    <label for="commitment" class="block text-left text-sm font-medium">Looking for</label>
                                    <select id="commitment" class="w-full text-base px-4 py-3 rounded-lg bg-bg-secondary border-none">
                                        <option value="">Select commitment type</option>
                                        <option value="casual">Casual dating</option>
                                        <option value="serious">Serious relationship</option>
                                        <option value="friendship">Just friendship</option>
                                        <option value="activity">Activity partners</option>
                                    </select>
                                </div>
                                
                                <div class="space-y-2">
                                    <label class="block text-left text-sm font-medium">Location Access</label>
                                    <div class="bg-bg-secondary p-4 rounded-lg flex items-center">
                                        <div class="flex-1">
                                            <p class="text-sm">Allow access to your location to find matches nearby</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="location-permission" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-checked:bg-primary rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
                
                <!-- Discovery Screen -->
                <section id="discovery-screen" class="absolute inset-0 flex flex-col p-4 hidden">
                    <div id="match-filters" class="mb-4 flex items-center gap-2 overflow-x-auto py-2 hide-scrollbar">
                        <button class="filter-chip active whitespace-nowrap px-4 py-2 rounded-full text-sm bg-primary text-primary-text">Nearby</button>
                        <button class="filter-chip whitespace-nowrap px-4 py-2 rounded-full text-sm bg-bg-secondary text-text">Age 25-35</button>
                        <button class="filter-chip whitespace-nowrap px-4 py-2 rounded-full text-sm bg-bg-secondary text-text">Serious</button>
                        <button class="filter-chip whitespace-nowrap px-4 py-2 rounded-full text-sm bg-bg-secondary text-text">Common Interests</button>
                        <button id="more-filters" class="whitespace-nowrap px-4 py-2 rounded-full text-sm bg-bg-secondary text-text flex items-center">
                            <span>More</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="flex-1 relative">
                        <div id="card-stack" class="absolute inset-0">
                            <!-- Profile cards will be inserted here -->
                            <div class="swipe-card absolute inset-0 p-4">
                                <div class="h-full w-full rounded-2xl overflow-hidden shadow-lg flex flex-col bg-bg-secondary relative">
                                    <div class="skeleton h-2/3 w-full bg-bg-secondary">
                                        <!-- Profile image placeholder -->
                                    </div>
                                    <div class="absolute top-4 right-4 flex space-x-2">
                                        <span class="badge px-3 py-1 rounded-full text-xs font-medium bg-primary/90 text-primary-text">2km away</span>
                                    </div>
                                    <div class="p-4 flex-1 flex flex-col">
                                        <div class="flex justify-between items-center mb-2">
                                            <h3 class="text-xl font-bold">Loading...</h3>
                                            <span class="text-lg">25</span>
                                        </div>
                                        <p class="text-text-secondary text-sm mb-3">Searching for profiles...</p>
                                        <div class="mt-auto flex items-center gap-2">
                                            <div class="skeleton h-8 w-8 rounded-full"></div>
                                            <div class="skeleton h-8 w-8 rounded-full"></div>
                                            <div class="skeleton h-8 w-8 rounded-full"></div>
                                            <div class="flex-1"></div>
                                            <div class="text-xs text-text-secondary flex items-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                                </svg>
                                                <span>Social Score: 78</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="absolute bottom-4 left-0 right-0 flex justify-center space-x-6 z-10">
                            <button id="dislike-button" class="h-14 w-14 rounded-full bg-white shadow-lg flex items-center justify-center active:scale-95 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button id="like-button" class="h-14 w-14 rounded-full bg-white shadow-lg flex items-center justify-center active:scale-95 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Matches Screen -->
                <section id="matches-screen" class="absolute inset-0 flex flex-col p-4 hidden">
                    <div class="tabs flex border-b border-bg-secondary mb-4">
                        <button class="tab-btn active flex-1 py-3 text-center border-b-2 border-primary font-medium">Matches</button>
                        <button class="tab-btn flex-1 py-3 text-center border-b-2 border-transparent text-text-secondary">Activities</button>
                    </div>
                    
                    <div id="matches-tab" class="flex-1 overflow-y-auto">
                        <div class="grid grid-cols-1 gap-4">
                            <!-- Empty state -->
                            <div id="empty-matches" class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-24 h-24 mb-4 rounded-full bg-bg-secondary flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-text-secondary" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <h3 class="text-lg font-medium mb-2">No matches yet</h3>
                                <p class="text-text-secondary mb-6">Start swiping to find your perfect match!</p>
                                <button id="go-discover" class="px-6 py-3 bg-primary text-primary-text rounded-lg active:scale-95 transition-transform">
                                    Start Matching
                                </button>
                            </div>
                            
                            <!-- Match list (initially hidden) -->
                            <div id="match-list" class="hidden">
                                <!-- Match cards will be inserted here -->
                            </div>
                        </div>
                    </div>
                    
                    <div id="activities-tab" class="flex-1 overflow-y-auto hidden">
                        <div class="grid grid-cols-1 gap-4">
                            <div class="p-4 rounded-lg bg-bg-secondary">
                                <h3 class="text-lg font-medium mb-2">Today's Challenge</h3>
                                <p class="text-text-secondary mb-3">Complete with your match to earn badges!</p>
                                <div class="bg-bg rounded-lg p-4 shadow-sm">
                                    <div class="flex items-start">
                                        <div class="h-12 w-12 rounded-full bg-primary/20 flex items-center justify-center mr-3 flex-shrink-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 2h10v7h-2l-1 2H8l-1-2H5V5z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-medium">Photo Challenge</h4>
                                            <p class="text-sm text-text-secondary">Both take a photo of your favorite place and share with each other.</p>
                                            <button class="mt-2 px-4 py-2 bg-primary text-primary-text text-sm rounded-lg active:scale-95 transition-transform">
                                                Start Challenge
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Activity cards will be inserted here -->
                        </div>
                    </div>
                </section>
                
                <!-- Chat Screen -->
                <section id="chat-screen" class="absolute inset-0 flex flex-col hidden">
                    <div id="chat-header" class="p-4 border-b border-bg-secondary flex items-center">
                        <button id="chat-back" class="mr-2 p-1 rounded-full hover:bg-bg-secondary active:bg-bg-secondary transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="chat-avatar" class="w-10 h-10 rounded-full bg-bg-secondary mr-3 overflow-hidden">
                            <!-- Profile image will be inserted here -->
                        </div>
                        <div class="flex-1">
                            <h3 id="chat-name" class="font-medium">Loading...</h3>
                            <p id="chat-status" class="text-xs text-text-secondary">Online</p>
                        </div>
                        <button id="chat-activity" class="p-2 rounded-full hover:bg-bg-secondary active:bg-bg-secondary transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                    
                    <div id="chat-messages" class="flex-1 overflow-y-auto p-4">
                        <div class="flex flex-col space-y-4">
                            <!-- Messages will be inserted here -->
                            <div class="text-center text-xs text-text-secondary py-2">Today</div>
                            
                            <div class="flex justify-center">
                                <div class="bg-primary/10 rounded-lg px-4 py-3 max-w-[80%] text-center">
                                    <p class="text-text-secondary text-sm">You matched with <span class="font-medium">Alex</span>!</p>
                                    <p class="text-text-secondary text-xs mt-1">Start a conversation or suggest an activity</p>
                                </div>
                            </div>
                            
                            <!-- Sample messages -->
                            <div class="flex justify-end">
                                <div class="bg-primary text-primary-text rounded-lg px-4 py-3 max-w-[80%]">
                                    <p>Hi there! I noticed we both enjoy hiking. Have you been to any good trails lately?</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-start">
                                <div class="bg-bg-secondary rounded-lg px-4 py-3 max-w-[80%]">
                                    <p>Hey! Yes, I went to Mountain View Trail last weekend. It was amazing! We should go sometime!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="chat-input" class="p-4 border-t border-bg-secondary">
                        <div class="flex items-center space-x-2">
                            <button id="chat-attachment" class="p-2 rounded-full hover:bg-bg-secondary active:bg-bg-secondary transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-text-secondary" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <input type="text" id="message-input" class="flex-1 bg-bg-secondary text-base rounded-full px-4 py-3" placeholder="Type a message...">
                            <button id="send-message" class="p-2 rounded-full bg-primary text-primary-text active:scale-95 transition-transform">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Badges Screen -->
                <section id="badges-screen" class="absolute inset-0 flex flex-col p-4 hidden">
                    <h2 class="text-xl font-bold mb-4">Your Badges</h2>
                    <p class="text-text-secondary mb-6">Complete activities with your matches to earn badges and increase your social score!</p>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <!-- Badge 1 -->
                        <div class="flex flex-col items-center">
                            <div class="w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center mb-2 badge-unlocked">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-center">First Match</span>
                        </div>
                        
                        <!-- Badge 2 -->
                        <div class="flex flex-col items-center">
                            <div class="w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center mb-2 badge-unlocked">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-center">Conversation Starter</span>
                        </div>
                        
                        <!-- Badge 3 -->
                        <div class="flex flex-col items-center">
                            <div class="w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center mb-2 badge-locked">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm9 4a1 1 0 10-2 0v6a1 1 0 102 0V7zm-3 2a1 1 0 10-2 0v4a1 1 0 102 0V9zm-3 3a1 1 0 10-2 0v1a1 1 0 102 0v-1z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-center">Activity Champion</span>
                        </div>
                        
                        <!-- Badge 4 -->
                        <div class="flex flex-col items-center">
                            <div class="w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center mb-2 badge-locked">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-center">Deep Connection</span>
                        </div>
                        
                        <!-- Badge 5 -->
                        <div class="flex flex-col items-center">
                            <div class="w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center mb-2 badge-locked">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 00-.553.894V17zM15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-center">Adventure Seeker</span>
                        </div>
                        
                        <!-- Badge 6 -->
                        <div class="flex flex-col items-center">
                            <div class="w-20 h-20 rounded-full bg-primary/20 flex items-center justify-center mb-2 badge-locked">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M6 3a1 1 0 011-1h.01a1 1 0 010 2H7a1 1 0 01-1-1zm2 3a1 1 0 00-2 0v1a2 2 0 00-2 2v1a2 2 0 00-2 2v.683a3.7 3.7 0 011.055.485 1.704 1.704 0 001.89 0 3.704 3.704 0 014.11 0 1.704 1.704 0 001.89 0 3.704 3.704 0 014.11 0 1.704 1.704 0 001.89 0A3.7 3.7 0 0118 12.683V12a2 2 0 00-2-2V9a2 2 0 00-2-2V6a1 1 0 10-2 0v1h-1V6a1 1 0 10-2 0v1H8V6zm10 8.868a3.704 3.704 0 01-4.055-.036 1.704 1.704 0 00-1.89 0 3.704 3.704 0 01-4.11 0 1.704 1.704 0 00-1.89 0A3.704 3.704 0 012 14.868V17a1 1 0 001 1h14a1 1 0 001-1v-2.132zM9 3a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm3 0a1 1 0 011-1h.01a1 1 0 110 2H13a1 1 0 01-1-1z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-center">Milestone Celebration</span>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h3 class="text-lg font-medium mb-3">Social Score</h3>
                        <div class="bg-bg-secondary rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium">Your Score</span>
                                <span class="text-primary font-bold">78</span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-2.5">
                                <div class="bg-primary h-2.5 rounded-full" style="width: 78%"></div>
                            </div>
                            <p class="text-xs text-text-secondary mt-2">Complete more activities to increase your score and get better matches!</p>
                        </div>
                    </div>
                </section>
                
                <!-- Profile Screen -->
                <section id="profile-screen" class="absolute inset-0 flex flex-col p-4 hidden">
                    <div class="flex flex-col items-center mb-6">
                        <div id="profile-avatar" class="w-24 h-24 rounded-full bg-bg-secondary overflow-hidden mb-3">
                            <!-- User profile image will be inserted here -->
                        </div>
                        <h2 id="profile-name" class="text-xl font-bold mb-1">Loading...</h2>
                        <p id="profile-info" class="text-text-secondary">Updating profile...</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-bg-secondary rounded-lg p-4">
                            <h3 class="font-medium mb-3">About Me</h3>
                            <textarea id="about-me" class="w-full bg-bg p-3 rounded-lg text-base" rows="4" placeholder="Tell others about yourself..."></textarea>
                        </div>
                        
                        <div class="bg-bg-secondary rounded-lg p-4">
                            <h3 class="font-medium mb-3">Interests</h3>
                            <div class="flex flex-wrap gap-2 mb-3">
                                <span class="interest-tag px-3 py-1 bg-primary/20 text-primary rounded-full text-sm">Travel</span>
                                <span class="interest-tag px-3 py-1 bg-primary/20 text-primary rounded-full text-sm">Hiking</span>
                                <span class="interest-tag px-3 py-1 bg-primary/20 text-primary rounded-full text-sm">Photography</span>
                                <button id="add-interest" class="px-3 py-1 bg-bg rounded-full text-sm border border-text-secondary text-text-secondary">
                                    + Add
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-bg-secondary rounded-lg p-4">
                            <h3 class="font-medium mb-3">Preferences</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="pref-gender" class="block text-sm mb-2">Looking for</label>
                                    <select id="pref-gender" class="w-full bg-bg p-3 rounded-lg text-base">
                                        <option value="male">Men</option>
                                        <option value="female">Women</option>
                                        <option value="everyone" selected>Everyone</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="pref-age-range" class="block text-sm mb-2">Age Range: <span id="age-range-value">18-35</span></label>
                                    <div class="px-1">
                                        <input type="range" id="pref-age-range" min="18" max="100" value="35" class="w-full">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="pref-distance" class="block text-sm mb-2">Maximum Distance: <span id="distance-value">25 km</span></label>
                                    <div class="px-1">
                                        <input type="range" id="pref-distance" min="1" max="100" value="25" class="w-full">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="pref-commitment" class="block text-sm mb-2">Looking for</label>
                                    <select id="pref-commitment" class="w-full bg-bg p-3 rounded-lg text-base">
                                        <option value="casual">Casual dating</option>
                                        <option value="serious" selected>Serious relationship</option>
                                        <option value="friendship">Just friendship</option>
                                        <option value="activity">Activity partners</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <button id="save-profile" class="w-full py-3 bg-primary text-primary-text rounded-lg active:scale-95 transition-transform">
                            Save Changes
                        </button>
                    </div>
                </section>
                
                <!-- Filter Modal -->
                <div id="filter-modal" class="fixed inset-0 bg-black/50 z-50 flex items-end justify-center p-4 hidden">
                    <div class="bg-bg rounded-t-xl w-full max-w-md animate-slide-in-right">
                        <div class="p-4 border-b border-bg-secondary flex justify-between items-center">
                            <h3 class="text-lg font-medium">Filter Matches</h3>
                            <button id="close-filter" class="p-1 rounded-full hover:bg-bg-secondary active:bg-bg-secondary transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                        
                        <div class="p-4 max-h-[70vh] overflow-y-auto">
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Distance</label>
                                    <div class="px-1">
                                        <input type="range" id="filter-distance" min="1" max="100" value="25" class="w-full">
                                        <div class="flex justify-between mt-1 text-xs text-text-secondary">
                                            <span>1 km</span>
                                            <span id="filter-distance-value">25 km</span>
                                            <span>100 km</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Age Range</label>
                                    <div class="px-1">
                                        <div class="flex space-x-4">
                                            <div class="flex-1">
                                                <input type="range" id="filter-age-min" min="18" max="100" value="18" class="w-full">
                                                <div class="flex justify-between mt-1 text-xs text-text-secondary">
                                                    <span>18</span>
                                                    <span id="filter-age-min-value">18</span>
                                                </div>
                                            </div>
                                            <div class="flex-1">
                                                <input type="range" id="filter-age-max" min="18" max="100" value="35" class="w-full">
                                                <div class="flex justify-between mt-1 text-xs text-text-secondary">
                                                    <span id="filter-age-max-value">35</span>
                                                    <span>100</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Commitment Type</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button class="filter-commitment active py-2 px-3 rounded-lg border border-primary bg-primary/10 text-primary text-sm">Casual</button>
                                        <button class="filter-commitment py-2 px-3 rounded-lg border border-bg-secondary text-text-secondary text-sm">Serious</button>
                                        <button class="filter-commitment py-2 px-3 rounded-lg border border-bg-secondary text-text-secondary text-sm">Friendship</button>
                                        <button class="filter-commitment py-2 px-3 rounded-lg border border-bg-secondary text-text-secondary text-sm">Activity</button>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Interests</label>
                                    <div class="flex flex-wrap gap-2">
                                        <button class="filter-interest py-1 px-3 rounded-full border border-bg-secondary text-text-secondary text-sm">Travel</button>
                                        <button class="filter-interest py-1 px-3 rounded-full border border-bg-secondary text-text-secondary text-sm">Music</button>
                                        <button class="filter-interest py-1 px-3 rounded-full border border-bg-secondary text-text-secondary text-sm">Fitness</button>
                                        <button class="filter-interest py-1 px-3 rounded-full border border-bg-secondary text-text-secondary text-sm">Art</button>
                                        <button class="filter-interest py-1 px-3 rounded-full border border-bg-secondary text-text-secondary text-sm">Food</button>
                                        <button class="filter-interest active py-1 px-3 rounded-full border border-primary bg-primary/10 text-primary text-sm">Hiking</button>
                                        <button class="filter-interest py-1 px-3 rounded-full border border-bg-secondary text-text-secondary text-sm">Movies</button>
                                        <button class="filter-interest py-1 px-3 rounded-full border border-bg-secondary text-text-secondary text-sm">Reading</button>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Social Score</label>
                                    <div class="px-1">
                                        <input type="range" id="filter-score" min="0" max="100" value="50" class="w-full">
                                        <div class="flex justify-between mt-1 text-xs text-text-secondary">
                                            <span>0</span>
                                            <span id="filter-score-value">50+</span>
                                            <span>100</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 border-t border-bg-secondary flex space-x-3">
                            <button id="reset-filters" class="flex-1 py-3 border border-bg-secondary rounded-lg active:scale-95 transition-transform">
                                Reset
                            </button>
                            <button id="apply-filters" class="flex-1 py-3 bg-primary text-primary-text rounded-lg active:scale-95 transition-transform">
                                Apply Filters
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Match Alert Modal -->
                <div id="match-alert" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 hidden">
                    <div class="bg-bg rounded-2xl w-full max-w-sm animate-fade-in text-center p-6">
                        <div class="flex justify-center mb-4">
                            <div class="relative">
                                <div class="w-24 h-24 rounded-full bg-bg-secondary overflow-hidden border-4 border-primary animate-pulse-slow">
                                    <!-- Match profile image will be inserted here -->
                                </div>
                                <div class="absolute -bottom-2 -right-2 h-10 w-10 rounded-full bg-primary flex items-center justify-center animate-bounce-slow">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-text" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <h2 class="text-xl font-bold mb-2">It's a Match!</h2>
                        <p class="text-text-secondary mb-6">You and <span id="match-name">Alex</span> liked each other!</p>
                        
                        <div class="flex flex-col space-y-3">
                            <button id="start-chat" class="w-full py-3 bg-primary text-primary-text rounded-lg active:scale-95 transition-transform">
                                Send a Message
                            </button>
                            <button id="suggest-activity" class="w-full py-3 border border-primary text-primary rounded-lg active:scale-95 transition-transform">
                                Suggest an Activity
                            </button>
                            <button id="keep-browsing" class="w-full py-3 text-text-secondary active:scale-95 transition-transform">
                                Keep Browsing
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav id="bottom-nav" class="grid grid-cols-4 border-t border-bg-secondary">
            <button class="nav-btn active flex flex-col items-center justify-center py-3" data-target="discovery-screen">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9 9a2 2 0 114 0 2 2 0 01-4 0z" />
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z" clip-rule="evenodd" />
                </svg>
                <span class="text-xs mt-1">Discover</span>
            </button>
            <button class="nav-btn flex flex-col items-center justify-center py-3" data-target="matches-screen">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
                <span class="text-xs mt-1">Matches</span>
            </button>
            <button class="nav-btn flex flex-col items-center justify-center py-3" data-target="badges-screen">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
                </svg>
                <span class="text-xs mt-1">Badges</span>
            </button>
            <button class="nav-btn flex flex-col items-center justify-center py-3" data-target="profile-screen">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span class="text-xs mt-1">Profile</span>
            </button>
        </nav>
    </div>

    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- App Scripts -->
    <script>
    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Telegram WebApp
        const tgApp = window.Telegram?.WebApp;
        
        // Set up color theme based on Telegram theme
        if (tgApp) {
            document.documentElement.style.setProperty('--tg-theme-bg-color', tgApp.backgroundColor || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-text-color', tgApp.textColor || '#222222');
            document.documentElement.style.setProperty('--tg-theme-hint-color', tgApp.colorScheme === 'dark' ? '#aaaaaa' : '#999999');
            document.documentElement.style.setProperty('--tg-theme-link-color', tgApp.linkColor || '#5D5CDE');
            document.documentElement.style.setProperty('--tg-theme-button-color', tgApp.buttonColor || '#5D5CDE');
            document.documentElement.style.setProperty('--tg-theme-button-text-color', tgApp.buttonTextColor || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', 
                tgApp.colorScheme === 'dark' ? '#2C2C2C' : '#F5F5F5');
                
            // Set up dark mode based on Telegram theme
            if (tgApp.colorScheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            
            // Initialize Telegram WebApp features
            tgApp.ready();
            tgApp.expand();
            
            // Set up BackButton handling
            tgApp.BackButton.onClick(() => {
                handleBackButton();
            });
            
            // Set up MainButton
            tgApp.MainButton.setParams({
                text: 'Continue',
                color: tgApp.buttonColor || '#5D5CDE',
                text_color: tgApp.buttonTextColor || '#ffffff',
                is_active: true,
                is_visible: false
            });
        } else {
            // Fallback for development without Telegram WebApp
            console.log("Telegram WebApp not available, using fallback theme");
            // Set dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
        }
        
        // App state management
        const appState = {
            user: null,
            currentScreen: 'loading-screen',
            navigationHistory: ['loading-screen'],
            userLocation: null,
            matches: [],
            profiles: [],
            messages: {},
            badges: [],
            userPreferences: {
                gender: '',
                interestedIn: '',
                age: '',
                commitment: '',
                maxDistance: 25,
                ageRange: [18, 35],
                interests: ['Travel', 'Hiking', 'Photography']
            },
            filters: {
                distance: 25,
                ageMin: 18,
                ageMax: 35,
                commitment: 'casual',
                interests: ['Hiking'],
                minScore: 50
            },
            socialScore: 78
        };
        
        // DOM elements
        const screens = document.querySelectorAll('section[id$="-screen"]');
        const navButtons = document.querySelectorAll('.nav-btn');
        const backButton = document.getElementById('back-button');
        const headerTitle = document.getElementById('header-title');
        const filterButton = document.getElementById('filter-button');
        const notificationButton = document.getElementById('notification-button');
        
        // Initialize the app with sample data (in production, this would be fetched from a server)
        initializeApp();
        
        // Navigation Functions
        function navigateTo(screenId, addToHistory = true) {
            // Hide all screens
            screens.forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // Show the target screen
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                appState.currentScreen = screenId;
                
                // Update navigation history
                if (addToHistory) {
                    appState.navigationHistory.push(screenId);
                }
                
                // Update active nav button
                navButtons.forEach(btn => {
                    if (btn.dataset.target === screenId) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Update header based on screen
                updateHeader(screenId);
                
                // Update Telegram WebApp BackButton visibility
                updateBackButton();
                
                // Execute screen-specific code
                handleScreenTransition(screenId);
            }
        }
        
        function handleBackButton() {
            if (appState.navigationHistory.length > 1) {
                // Remove current screen from history
                appState.navigationHistory.pop();
                
                // Navigate to previous screen
                const previousScreen = appState.navigationHistory[appState.navigationHistory.length - 1];
                navigateTo(previousScreen, false);
            }
        }
        
        function updateBackButton() {
            const canGoBack = appState.navigationHistory.length > 1;
            
            // Update native app back button if available
            if (tgApp && tgApp.BackButton) {
                if (canGoBack) {
                    tgApp.BackButton.show();
                } else {
                    tgApp.BackButton.hide();
                }
            }
            
            // Update in-app back button
            if (canGoBack) {
                backButton.classList.remove('hidden');
            } else {
                backButton.classList.add('hidden');
            }
        }
        
        function updateHeader(screenId) {
            // Set header title based on screen
            switch (screenId) {
                case 'discovery-screen':
                    headerTitle.textContent = 'Discover';
                    filterButton.classList.remove('hidden');
                    notificationButton.classList.add('hidden');
                    break;
                case 'matches-screen':
                    headerTitle.textContent = 'Matches';
                    filterButton.classList.add('hidden');
                    notificationButton.classList.remove('hidden');
                    break;
                case 'badges-screen':
                    headerTitle.textContent = 'Badges';
                    filterButton.classList.add('hidden');
                    notificationButton.classList.add('hidden');
                    break;
                case 'profile-screen':
                    headerTitle.textContent = 'My Profile';
                    filterButton.classList.add('hidden');
                    notificationButton.classList.add('hidden');
                    break;
                case 'chat-screen':
                    headerTitle.textContent = '';
                    filterButton.classList.add('hidden');
                    notificationButton.classList.add('hidden');
                    break;
                default:
                    headerTitle.textContent = 'Connection Quest';
                    filterButton.classList.add('hidden');
                    notificationButton.classList.add('hidden');
            }
        }
        
        function handleScreenTransition(screenId) {
            // Execute screen-specific initialization code
            switch (screenId) {
                case 'onboarding-screen':
                    if (tgApp && tgApp.MainButton) {
                        tgApp.MainButton.setText('Continue');
                        tgApp.MainButton.show();
                        
                        tgApp.MainButton.onClick(() => {
                            saveOnboardingData();
                            navigateTo('discovery-screen');
                            tgApp.MainButton.hide();
                        });
                    }
                    break;
                    
                case 'discovery-screen':
                    if (tgApp && tgApp.MainButton) {
                        tgApp.MainButton.hide();
                    }
                    
                    // Load profile cards if not already loaded
                    if (appState.profiles.length === 0) {
                        loadProfiles();
                    }
                    break;
                    
                default:
                    if (tgApp && tgApp.MainButton) {
                        tgApp.MainButton.hide();
                    }
            }
        }
        
        // Event Listeners
        navButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetScreenId = btn.dataset.target;
                navigateTo(targetScreenId);
                
                // Add haptic feedback if available
                if (tgApp && tgApp.HapticFeedback) {
                    tgApp.HapticFeedback.impactOccurred('light');
                }
            });
        });
        
        backButton.addEventListener('click', () => {
            handleBackButton();
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('light');
            }
        });
        
        // Filter button click handler
        filterButton.addEventListener('click', () => {
            document.getElementById('filter-modal').classList.remove('hidden');
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('light');
            }
        });
        
        // Close filter modal
        document.getElementById('close-filter').addEventListener('click', () => {
            document.getElementById('filter-modal').classList.add('hidden');
        });
        
        // Apply filters
        document.getElementById('apply-filters').addEventListener('click', () => {
            // Update filters state
            appState.filters.distance = parseInt(document.getElementById('filter-distance').value);
            appState.filters.ageMin = parseInt(document.getElementById('filter-age-min').value);
            appState.filters.ageMax = parseInt(document.getElementById('filter-age-max').value);
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('medium');
            }
            
            // Close modal and reload profiles with new filters
            document.getElementById('filter-modal').classList.add('hidden');
            loadProfiles();
        });
        
        // Reset filters
        document.getElementById('reset-filters').addEventListener('click', () => {
            // Reset filter inputs
            document.getElementById('filter-distance').value = 25;
            document.getElementById('filter-age-min').value = 18;
            document.getElementById('filter-age-max').value = 35;
            document.getElementById('filter-score').value = 50;
            
            // Update filter values
            document.getElementById('filter-distance-value').textContent = '25 km';
            document.getElementById('filter-age-min-value').textContent = '18';
            document.getElementById('filter-age-max-value').textContent = '35';
            document.getElementById('filter-score-value').textContent = '50+';
            
            // Reset commitment and interest buttons
            document.querySelectorAll('.filter-commitment').forEach(btn => {
                if (btn.textContent.trim().toLowerCase() === 'casual') {
                    btn.classList.add('active');
                    btn.classList.add('border-primary', 'bg-primary/10', 'text-primary');
                    btn.classList.remove('border-bg-secondary', 'text-text-secondary');
                } else {
                    btn.classList.remove('active');
                    btn.classList.remove('border-primary', 'bg-primary/10', 'text-primary');
                    btn.classList.add('border-bg-secondary', 'text-text-secondary');
                }
            });
            
            document.querySelectorAll('.filter-interest').forEach(btn => {
                if (btn.textContent.trim().toLowerCase() === 'hiking') {
                    btn.classList.add('active');
                    btn.classList.add('border-primary', 'bg-primary/10', 'text-primary');
                    btn.classList.remove('border-bg-secondary', 'text-text-secondary');
                } else {
                    btn.classList.remove('active');
                    btn.classList.remove('border-primary', 'bg-primary/10', 'text-primary');
                    btn.classList.add('border-bg-secondary', 'text-text-secondary');
                }
            });
            
            // Reset app state filters
            appState.filters = {
                distance: 25,
                ageMin: 18,
                ageMax: 35,
                commitment: 'casual',
                interests: ['Hiking'],
                minScore: 50
            };
        });
        
        // Range input event listeners
        document.getElementById('filter-distance').addEventListener('input', (e) => {
            document.getElementById('filter-distance-value').textContent = `${e.target.value} km`;
        });
        
        document.getElementById('filter-age-min').addEventListener('input', (e) => {
            document.getElementById('filter-age-min-value').textContent = e.target.value;
            
            // Ensure min doesn't exceed max
            const maxAge = parseInt(document.getElementById('filter-age-max').value);
            if (parseInt(e.target.value) > maxAge) {
                document.getElementById('filter-age-max').value = e.target.value;
                document.getElementById('filter-age-max-value').textContent = e.target.value;
            }
        });
        
        document.getElementById('filter-age-max').addEventListener('input', (e) => {
            document.getElementById('filter-age-max-value').textContent = e.target.value;
            
            // Ensure max isn't less than min
            const minAge = parseInt(document.getElementById('filter-age-min').value);
            if (parseInt(e.target.value) < minAge) {
                document.getElementById('filter-age-min').value = e.target.value;
                document.getElementById('filter-age-min-value').textContent = e.target.value;
            }
        });
        
        document.getElementById('filter-score').addEventListener('input', (e) => {
            document.getElementById('filter-score-value').textContent = `${e.target.value}+`;
        });
        
        // Like and dislike buttons
        document.getElementById('like-button').addEventListener('click', () => {
            handleSwipe('right');
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('medium');
            }
        });
        
        document.getElementById('dislike-button').addEventListener('click', () => {
            handleSwipe('left');
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('light');
            }
        });
        
        // Match alert buttons
        document.getElementById('start-chat').addEventListener('click', () => {
            document.getElementById('match-alert').classList.add('hidden');
            navigateTo('chat-screen');
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('medium');
            }
        });
        
        document.getElementById('suggest-activity').addEventListener('click', () => {
            document.getElementById('match-alert').classList.add('hidden');
            navigateTo('matches-screen');
            
            // Switch to the activities tab
            document.querySelectorAll('.tab-btn')[1].click();
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('medium');
            }
        });
        
        document.getElementById('keep-browsing').addEventListener('click', () => {
            document.getElementById('match-alert').classList.add('hidden');
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('light');
            }
        });
        
        // Tab navigation in matches screen
        document.querySelectorAll('.tab-btn').forEach((tabBtn, index) => {
            tabBtn.addEventListener('click', () => {
                // Remove active class from all tabs
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.classList.remove('border-primary');
                    btn.classList.add('border-transparent', 'text-text-secondary');
                });
                
                // Add active class to clicked tab
                tabBtn.classList.add('active');
                tabBtn.classList.add('border-primary');
                tabBtn.classList.remove('border-transparent', 'text-text-secondary');
                
                // Show corresponding tab content
                if (index === 0) {
                    document.getElementById('matches-tab').classList.remove('hidden');
                    document.getElementById('activities-tab').classList.add('hidden');
                } else {
                    document.getElementById('matches-tab').classList.add('hidden');
                    document.getElementById('activities-tab').classList.remove('hidden');
                }
                
                // Add haptic feedback if available
                if (tgApp && tgApp.HapticFeedback) {
                    tgApp.HapticFeedback.impactOccurred('light');
                }
            });
        });
        
        // Profile screen event listeners
        document.getElementById('pref-age-range').addEventListener('input', (e) => {
            document.getElementById('age-range-value').textContent = `18-${e.target.value}`;
        });
        
        document.getElementById('pref-distance').addEventListener('input', (e) => {
            document.getElementById('distance-value').textContent = `${e.target.value} km`;
        });
        
        document.getElementById('save-profile').addEventListener('click', () => {
            // Save profile changes
            appState.userPreferences.maxDistance = parseInt(document.getElementById('pref-distance').value);
            appState.userPreferences.ageRange = [18, parseInt(document.getElementById('pref-age-range').value)];
            appState.userPreferences.interestedIn = document.getElementById('pref-gender').value;
            appState.userPreferences.commitment = document.getElementById('pref-commitment').value;
            
            // Update about me
            const aboutMe = document.getElementById('about-me').value;
            
            // Show success message
            showToast('Profile updated successfully!');
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('medium');
            }
        });
        
        // Chat screen event listeners
        document.getElementById('chat-back').addEventListener('click', () => {
            navigateTo('matches-screen');
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('light');
            }
        });
        
        document.getElementById('send-message').addEventListener('click', () => {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value.trim();
            
            if (message) {
                // Add message to chat
                addMessage(message, 'outgoing');
                
                // Clear input
                messageInput.value = '';
                
                // Simulate reply after delay
                setTimeout(() => {
                    simulateReply();
                }, 1500);
                
                // Add haptic feedback if available
                if (tgApp && tgApp.HapticFeedback) {
                    tgApp.HapticFeedback.impactOccurred('light');
                }
            }
        });
        
        // Filter commitment buttons
        document.querySelectorAll('.filter-commitment').forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all
                document.querySelectorAll('.filter-commitment').forEach(b => {
                    b.classList.remove('active');
                    b.classList.remove('border-primary', 'bg-primary/10', 'text-primary');
                    b.classList.add('border-bg-secondary', 'text-text-secondary');
                });
                
                // Add active class to clicked
                btn.classList.add('active');
                btn.classList.add('border-primary', 'bg-primary/10', 'text-primary');
                btn.classList.remove('border-bg-secondary', 'text-text-secondary');
                
                // Update state
                appState.filters.commitment = btn.textContent.trim().toLowerCase();
            });
        });
        
        // Filter interest buttons
        document.querySelectorAll('.filter-interest').forEach(btn => {
            btn.addEventListener('click', () => {
                // Toggle active class
                btn.classList.toggle('active');
                
                if (btn.classList.contains('active')) {
                    btn.classList.add('border-primary', 'bg-primary/10', 'text-primary');
                    btn.classList.remove('border-bg-secondary', 'text-text-secondary');
                    appState.filters.interests.push(btn.textContent.trim());
                } else {
                    btn.classList.remove('border-primary', 'bg-primary/10', 'text-primary');
                    btn.classList.add('border-bg-secondary', 'text-text-secondary');
                    appState.filters.interests = appState.filters.interests.filter(
                        interest => interest !== btn.textContent.trim()
                    );
                }
            });
        });
        
        // Core App Functions
        function initializeApp() {
            // Attempt to get user data from Telegram WebApp
            if (tgApp && tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                appState.user = {
                    id: tgApp.initDataUnsafe.user.id,
                    name: tgApp.initDataUnsafe.user.first_name,
                    username: tgApp.initDataUnsafe.user.username,
                    photoUrl: null // Telegram doesn't provide photo in initData
                };
                
                // Update UI with user data
                updateUserData();
                
                // Check if first time user (would check server in real app)
                const isFirstTimeUser = true;
                
                if (isFirstTimeUser) {
                    // Show onboarding after short delay
                    setTimeout(() => {
                        navigateTo('onboarding-screen');
                    }, 1500);
                } else {
                    // Navigate to discovery screen
                    setTimeout(() => {
                        navigateTo('discovery-screen');
                    }, 1500);
                }
            } else {
                // Mock user data for development
                appState.user = {
                    id: 12345,
                    name: 'User',
                    username: 'user123',
                    photoUrl: null
                };
                
                // Update UI with user data
                updateUserData();
                
                // Show onboarding
                setTimeout(() => {
                    navigateTo('onboarding-screen');
                }, 1500);
            }
            
            // Request location permission if available
            if (navigator.geolocation) {
                document.getElementById('location-permission').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        requestLocationPermission();
                    }
                });
            }
        }
        
        function updateUserData() {
            // Update welcome text
            const welcomeText = document.getElementById('welcome-text');
            if (welcomeText) {
                welcomeText.textContent = `Welcome, ${appState.user.name}!`;
            }
            
            // Update profile screen
            const profileName = document.getElementById('profile-name');
            const profileInfo = document.getElementById('profile-info');
            
            if (profileName) {
                profileName.textContent = appState.user.name;
            }
            
            if (profileInfo) {
                profileInfo.textContent = `@${appState.user.username || 'username'}`;
            }
        }
        
        function saveOnboardingData() {
            // Get form values
            const gender = document.getElementById('gender').value;
            const interestedIn = document.getElementById('interested-in').value;
            const age = document.getElementById('age').value;
            const commitment = document.getElementById('commitment').value;
            
            // Update state
            appState.userPreferences.gender = gender;
            appState.userPreferences.interestedIn = interestedIn;
            appState.userPreferences.age = age;
            appState.userPreferences.commitment = commitment;
            
            // In a real app, this would be sent to a server
            console.log('Saving onboarding data:', appState.userPreferences);
        }
        
        function requestLocationPermission() {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    appState.userLocation = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                    console.log('Location obtained:', appState.userLocation);
                    
                    // Show success message
                    showToast('Location access granted!');
                },
                (error) => {
                    console.error('Error getting location:', error);
                    
                    // Show error message
                    showToast('Unable to access location. Please check your settings.', 'error');
                    
                    // Uncheck the switch
                    document.getElementById('location-permission').checked = false;
                }
            );
        }
        
        function loadProfiles() {
            // In a real app, this would fetch data from a server
            // Here we'll generate some mock profiles
            const mockProfiles = generateMockProfiles(10);
            appState.profiles = mockProfiles;
            
            // Render the profiles in the discovery screen
            renderProfiles();
        }
        
        function renderProfiles() {
            const cardStack = document.getElementById('card-stack');
            
            // Clear existing cards
            cardStack.innerHTML = '';
            
            // Add profile cards
            appState.profiles.forEach((profile, index) => {
                const card = createProfileCard(profile, index);
                cardStack.appendChild(card);
            });
        }
        
        function createProfileCard(profile, index) {
            const card = document.createElement('div');
            card.className = 'swipe-card absolute inset-0 p-4';
            card.style.zIndex = 100 - index;
            card.dataset.profileId = profile.id;
            
            let badgeIcons = '';
            profile.badges.forEach(badge => {
                badgeIcons += `<div class="h-8 w-8 rounded-full bg-primary/20 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="${badge.icon}" clip-rule="evenodd" />
                    </svg>
                </div>`;
            });
            
            card.innerHTML = `
                <div class="h-full w-full rounded-2xl overflow-hidden shadow-lg flex flex-col bg-bg-secondary relative">
                    <div class="h-2/3 w-full bg-gray-300 relative">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                        <div style="background-color:${profile.color}" class="absolute inset-0 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-white/30" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>
                    <div class="absolute top-4 right-4 flex space-x-2">
                        <span class="badge px-3 py-1 rounded-full text-xs font-medium bg-primary/90 text-primary-text">${profile.distance}km away</span>
                    </div>
                    <div class="p-4 flex-1 flex flex-col">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-bold">${profile.name}</h3>
                            <span class="text-lg">${profile.age}</span>
                        </div>
                        <p class="text-text-secondary text-sm mb-3">${profile.bio}</p>
                        <div class="mt-auto flex items-center gap-2">
                            ${badgeIcons}
                            <div class="flex-1"></div>
                            <div class="text-xs text-text-secondary flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                                <span>Social Score: ${profile.socialScore}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        function handleSwipe(direction) {
            const cardStack = document.getElementById('card-stack');
            const currentCard = cardStack.children[0];
            
            if (!currentCard) return;
            
            // Get profile ID
            const profileId = currentCard.dataset.profileId;
            
            // Add swipe animation class
            if (direction === 'left') {
                currentCard.classList.add('swipe-left');
            } else {
                currentCard.classList.add('swipe-right');
            }
            
            // Remove card after animation
            setTimeout(() => {
                currentCard.remove();
                
                // Check if it was a match (for demo purposes, 30% chance)
                if (direction === 'right' && Math.random() < 0.3) {
                    showMatchAlert(profileId);
                }
                
                // Check if we need to load more profiles
                if (cardStack.children.length < 3) {
                    loadMoreProfiles();
                }
            }, 300);
        }
        
        function loadMoreProfiles() {
            // In a real app, this would fetch more profiles from a server
            // Here we'll generate more mock profiles
            const moreProfiles = generateMockProfiles(5);
            appState.profiles = [...appState.profiles, ...moreProfiles];
            
            // Render the new profiles
            renderProfiles();
        }
        
        function showMatchAlert(profileId) {
            // Find the profile
            const profile = appState.profiles.find(p => p.id === profileId);
            
            if (!profile) return;
            
            // Update match alert UI
            document.getElementById('match-name').textContent = profile.name;
            
            // Show match alert
            document.getElementById('match-alert').classList.remove('hidden');
            
            // Add match to matches list
            appState.matches.push(profile);
            
            // Update matches UI if on matches screen
            if (appState.currentScreen === 'matches-screen') {
                updateMatchesUI();
            }
            
            // Add haptic feedback if available
            if (tgApp && tgApp.HapticFeedback) {
                tgApp.HapticFeedback.impactOccurred('heavy');
                setTimeout(() => {
                    tgApp.HapticFeedback.notificationOccurred('success');
                }, 300);
            }
        }
        
        function updateMatchesUI() {
            const matchList = document.getElementById('match-list');
            const emptyMatches = document.getElementById('empty-matches');
            
            if (appState.matches.length > 0) {
                // Show match list
                matchList.classList.remove('hidden');
                emptyMatches.classList.add('hidden');
                
                // Clear match list
                matchList.innerHTML = '';
                
                // Add match cards
                appState.matches.forEach(match => {
                    const matchCard = document.createElement('div');
                    matchCard.className = 'bg-bg-secondary rounded-lg overflow-hidden';
                    matchCard.innerHTML = `
                        <div class="flex items-center p-4">
                            <div class="w-14 h-14 rounded-full mr-4 overflow-hidden" style="background-color:${match.color}">
                                <div class="w-full h-full flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white/30" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <h3 class="font-medium">${match.name}, ${match.age}</h3>
                                    <span class="text-xs text-text-secondary">${match.distance}km</span>
                                </div>
                                <p class="text-sm text-text-secondary line-clamp-1">${match.bio}</p>
                            </div>
                        </div>
                        <div class="border-t border-bg flex">
                            <button class="start-chat flex-1 py-3 text-center text-text-secondary" data-profile-id="${match.id}">
                                <span>Message</span>
                            </button>
                            <div class="border-r border-bg"></div>
                            <button class="suggest-activity flex-1 py-3 text-center text-text-secondary" data-profile-id="${match.id}">
                                <span>Activity</span>
                            </button>
                        </div>
                    `;
                    
                    matchList.appendChild(matchCard);
                });
                
                // Add event listeners to chat buttons
                document.querySelectorAll('.start-chat').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const profileId = btn.dataset.profileId;
                        openChat(profileId);
                    });
                });
                
                // Add event listeners to activity buttons
                document.querySelectorAll('.suggest-activity').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const profileId = btn.dataset.profileId;
                        
                        // Switch to activities tab
                        document.querySelectorAll('.tab-btn')[1].click();
                    });
                });
            } else {
                // Show empty state
                matchList.classList.add('hidden');
                emptyMatches.classList.remove('hidden');
            }
        }
        
        function openChat(profileId) {
            // Find profile
            const profile = appState.matches.find(p => p.id === profileId);
            
            if (!profile) return;
            
            // Update chat header
            document.getElementById('chat-name').textContent = profile.name;
            
            // Update chat avatar background color
            const chatAvatar = document.getElementById('chat-avatar');
            chatAvatar.style.backgroundColor = profile.color;
            chatAvatar.innerHTML = `
                <div class="w-full h-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white/30" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                    </svg>
                </div>
            `;
            
            // Navigate to chat screen
            navigateTo('chat-screen');
        }
        
        function addMessage(text, type) {
            const chatMessages = document.getElementById('chat-messages');
            const messageEl = document.createElement('div');
            
            messageEl.className = type === 'outgoing' 
                ? 'flex justify-end' 
                : 'flex justify-start';
                
            messageEl.innerHTML = `
                <div class="${type === 'outgoing' ? 'bg-primary text-primary-text' : 'bg-bg-secondary'} rounded-lg px-4 py-3 max-w-[80%]">
                    <p>${text}</p>
                </div>
            `;
            
            chatMessages.appendChild(messageEl);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function simulateReply() {
            const replies = [
                "That sounds great! When are you free?",
                "I'd love to try that! Have you been there before?",
                "That's interesting! Tell me more about it.",
                "I've been wanting to do that for a while now!",
                "That's a great idea! Let's plan it soon."
            ];
            
            const randomReply = replies[Math.floor(Math.random() * replies.length)];
            addMessage(randomReply, 'incoming');
        }
        
        function showToast(message, type = 'success') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `fixed bottom-20 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg text-sm font-medium z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            } animate-fade-in`;
            toast.textContent = message;
            
            // Add to body
            document.body.appendChild(toast);
            
            // Remove after delay
            setTimeout(() => {
                toast.classList.remove('animate-fade-in');
                toast.classList.add('animate-fade-out');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
        
        // Utility Functions
        function generateMockProfiles(count) {
            const names = ['Alex', 'Jordan', 'Taylor', 'Morgan', 'Casey', 'Riley', 'Jamie', 'Avery', 'Quinn', 'Blake'];
            const bios = [
                'Love hiking and outdoor adventures.',
                'Coffee enthusiast and amateur photographer.',
                'Foodie who loves trying new restaurants.',
                'Book lover and aspiring writer.',
                'Fitness fanatic and yoga instructor.',
                'Music lover and concert-goer.',
                'Travel addict, always planning the next trip.',
                'Movie buff with a passion for indie films.',
                'Art enthusiast and museum explorer.',
                'Nature lover and environmentalist.'
            ];
            const colors = ['#7C3AED', '#EC4899', '#3B82F6', '#10B981', '#F59E0B', '#6366F1', '#8B5CF6', '#F43F5E', '#0EA5E9', '#14B8A6'];
            const iconPaths = [
                'M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z',
                'M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm9 4a1 1 0 10-2 0v6a1 1 0 102 0V7zm-3 2a1 1 0 10-2 0v4a1 1 0 102 0V9zm-3 3a1 1 0 10-2 0v1a1 1 0 102 0v-1z',
                'M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z',
                'M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z'
            ];
            
            const profiles = [];
            
            for (let i = 0; i < count; i++) {
                const nameIndex = Math.floor(Math.random() * names.length);
                const bioIndex = Math.floor(Math.random() * bios.length);
                const colorIndex = Math.floor(Math.random() * colors.length);
                
                // Generate 1-3 random badges
                const badgeCount = Math.floor(Math.random() * 3) + 1;
                const badges = [];
                
                for (let j = 0; j < badgeCount; j++) {
                    const iconIndex = Math.floor(Math.random() * iconPaths.length);
                    badges.push({
                        icon: iconPaths[iconIndex]
                    });
                }
                
                profiles.push({
                    id: `profile-${i}`,
                    name: names[nameIndex],
                    age: Math.floor(Math.random() * 15) + 20, // 20-35
                    bio: bios[bioIndex],
                    distance: Math.floor(Math.random() * 30) + 1, // 1-30 km
                    socialScore: Math.floor(Math.random() * 40) + 60, // 60-100
                    color: colors[colorIndex],
                    badges: badges
                });
            }
            
            return profiles;
        }
        
        // Go-to-discover button event listener
        document.getElementById('go-discover').addEventListener('click', () => {
            navigateTo('discovery-screen');
        });
    });
    </script>
</body>
</html>
